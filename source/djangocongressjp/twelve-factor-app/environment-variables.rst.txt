1ï¸âƒ£ III. è¨­å®š
======================================================================

    è¨­å®šã‚’ç’°å¢ƒå¤‰æ•°ã«æ ¼ç´ã™ã‚‹

https://12factor.net/ja/config

è¨­å®šã‚’ **ç’°å¢ƒå¤‰æ•°** ã«
--------------------------------------------------

* è¨­å®šã¨ã¯ä¾‹ãˆã°ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
* è¨­å®šã‚’ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å³å¯†ã«åˆ†é›¢ã—ãŸã„
* ç’°å¢ƒå¤‰æ•°ã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã€ **ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ã—ãªã„** ãŒå®Ÿç¾ã§ãã‚‹

.. ğŸƒâ€â™‚ï¸k8sã§ã¯Podã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

pydantic-settings
--------------------------------------------------

* https://docs.pydantic.dev/latest/concepts/pydantic_settings/
* ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€ + Pydanticã«ã‚ˆã‚‹ãƒ‘ãƒ¼ã‚¹
* ç’°å¢ƒå¤‰æ•°ã ã‘ã§ãªã :file:`.env` ã‚‚ã‚µãƒãƒ¼ãƒˆ

pydantic-settingsã§ã®è¨­å®šä¾‹
--------------------------------------------------

.. code-block:: python

    from pydantic import PostgresDsn
    from pydantic_settings import BaseSettings


    class Config(BaseSettings):
        pg_dsn: PostgresDsn


    config = Config()

ç’°å¢ƒå¤‰æ•° ``PG_DSN`` ã§è¨­å®šã§ãã‚‹

ãƒã‚¹ãƒˆã‚‚å¯èƒ½
--------------------------------------------------

DBã®è¨­å®šã€LLM APIã®è¨­å®šã¨åˆ†ã‘ãŸã„

.. code-block:: python

    class DB(BaseModel):
        pg_dsn: PostgresDsn
    
    class LlmApi(BaseModel):
        api_key: str

    class Config(BaseSettings):
        model_config = SettingsConfigDict(env_nested_delimiter="__")
        db: DB
        llm: LlmApi

    config = Config()

ç’°å¢ƒå¤‰æ•° ``DB__PG_DSN`` ã‚„ ``LLM__API_KEY``

ğŸƒâ€â™‚ï¸è„±ç·šï¼špydantic-settingsã§CLIã‚‚ä½œã‚Œã¾ã™ï¼
--------------------------------------------------

* å€‹äººçš„ã‚¤ãƒã‚ªã‚·ãƒã‚¤ãƒ³ãƒˆï¼ˆã•ã‚ˆãªã‚‰argparseï¼‰
* æ‹™ãƒ–ãƒ­ã‚° `pydantic-settingsã§ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã‚‚æŒ‡å®šã§ãã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°ã‚’æŒã¤CLIã‚’ä½œã‚‹ <https://nikkie-ftnext.hatenablog.com/entry/pydantic-settings-cli-application-args-optional-environment-positional>`__
