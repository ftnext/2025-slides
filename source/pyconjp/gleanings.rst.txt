Chapter 5: è½ç©‚æ‹¾ã„
======================================================================

1. æœ€çµ‚æ‰‹æ®µãƒãƒ³ãƒ‰ãƒ©
2. è¨­å®šæ–¹æ³•ã®é¸æŠè‚¢ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã®è¨­å®šå«ã‚€ï¼‰
3. æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª logging ä»¥å¤–ã®é¸æŠè‚¢ï¼ˆloguruãªã©ï¼‰

1ï¸âƒ£ æœ€çµ‚æ‰‹æ®µãƒãƒ³ãƒ‰ãƒ©
======================================================================

.. literalinclude:: ../../samplecode/python-logging/last_resort_example/mylib.py
    :language: python
    :lines: 1-6,8
    :caption: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§warningã®ãƒ­ã‚®ãƒ³ã‚°

å®Ÿã¯ ``basicConfig()`` ãªã—ã§ãƒ­ã‚®ãƒ³ã‚°ã§ãã¾ã™
--------------------------------------------------

.. literalinclude:: ../../samplecode/python-logging/last_resort_example/app.py
    :language: python
    :caption: ãƒ«ãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼ã‚’è¨­å®šã—ãªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰

.. code-block:: txt

    ã¡ã‚‡ã£ã¨ãƒ¤ãƒã„ã‚ˆ

ãƒ­ã‚¬ãƒ¼ã«ãƒãƒ³ãƒ‰ãƒ©ã‚’æŒ‡å®šã—ãªã„ã¨ã
--------------------------------------------------

    ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€ ``lastResort`` ã«æ ¼ç´ã•ã‚ŒãŸã€Œæœ€çµ‚æ‰‹æ®µãƒãƒ³ãƒ‰ãƒ©ã€ã‚’ä½¿ç”¨ã—ã¦å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

    ãƒãƒ³ãƒ‰ãƒ©ã®ãƒ¬ãƒ™ãƒ«ã¯ ``WARNING`` ã«ã‚»ãƒƒãƒˆã•ã‚Œã€(ç•¥)

`ç’°å¢ƒè¨­å®šãŒä¸ãˆã‚‰ã‚Œãªã„ã¨ã©ã†ãªã‚‹ã‹ <https://docs.python.org/ja/3/howto/logging.html#what-happens-if-no-configuration-is-provided>`__

.. ä¸Šè¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ˆã‚Šã€Œæœ€çµ‚æ‰‹æ®µãƒãƒ³ãƒ‰ãƒ©ã¯WARNINGãƒ¬ãƒ™ãƒ«ã€ãªã®ã§ã€rootãƒ­ã‚¬ãƒ¼ã®ãƒ¬ãƒ™ãƒ«ã‚’DEBUGã«ä¸‹ã’ã¦ã‚‚ãƒ­ã‚°å‡ºåŠ›ã¯ãªã„

æœ€çµ‚æ‰‹æ®µãƒãƒ³ãƒ‰ãƒ©ã‚’ä½¿ã‚ãªã„ãªã‚‰ ``NullHandler``
--------------------------------------------------

    ä½•ã‚‰ã‹ã®ç†ç”±ã§ãƒ­ã‚®ãƒ³ã‚°è¨­å®šãŒãªã•ã‚Œã¦ã„ãªã„ã¨ãã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º *ã•ã›ãŸããªã„* ã®ã§ã‚ã‚Œã°ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚¬ãƒ¼ã«ä½•ã‚‚ã—ãªã„ãƒãƒ³ãƒ‰ãƒ©ã‚’å–ã‚Šä»˜ã‘ã‚‰ã‚Œã¾ã™ã€‚

`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãŸã‚ã®ãƒ­ã‚®ãƒ³ã‚°ã®è¨­å®š <https://docs.python.org/ja/3/howto/logging.html#configuring-logging-for-a-library>`__

``NullHandler`` ä»¥å¤–ã‚’å–ã‚Šä»˜ã‘ã¦ã¯ã„ã‘ã¾ã›ã‚“ğŸ™…â€â™‚ï¸
--------------------------------------------------

* ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ­ã‚¬ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒ©ã§å‡ºåŠ›
* è¦ªã®ãƒ«ãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼ã«ä¼æ’­ï¼ˆpropagateï¼‰ã—ã€ ãƒ«ãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒ©ã§ã‚‚å‡¦ç†ã—ã¦ **2é‡** å‡ºåŠ›

2ï¸âƒ£ è¨­å®šæ–¹æ³•ã®é¸æŠè‚¢
======================================================================

.. literalinclude:: ../../samplecode/python-logging/library_logger/root_logging_hard.py
    :language: python
    :lines: 13-22

.. _dictConfig: https://docs.python.org/ja/3/library/logging.config.html#logging.config.dictConfig

`dictConfig`_
--------------------------------------------------

.. literalinclude:: ../../samplecode/python-logging/library_logger/root_logging_dictconfig.py
    :language: python
    :lines: 8,13-39

.. _fileConfig: https://docs.python.org/ja/3/library/logging.config.html#logging.config.fileConfig

ã‚³ãƒ¼ãƒ‰ã®ä»£ã‚ã‚Šã« `fileConfig`_
--------------------------------------------------

* `configparser <https://docs.python.org/ja/3/library/configparser.html>`__ å½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®š [#configparser-file]_

    ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€ [loggers], [handlers], [formatters] ã¨ã„ã£ãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå…¥ã£ã¦ã„ãªã‘ã‚Œã°ãªã‚‰ãšã€ï¼ˆ`ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸å¼ <https://docs.python.org/ja/3/library/logging.config.html#configuration-file-format>`__ï¼‰

.. [#configparser-file] `ãƒ­ã‚®ãƒ³ã‚°ã®ç’°å¢ƒè¨­å®š <https://docs.python.org/ja/3/howto/logging.html#configuring-logging>`__ ã§è¦‹ã‚‰ã‚Œã¾ã™

ğŸ’¡YAMLãƒ•ã‚¡ã‚¤ãƒ« + ``dictConfig``
--------------------------------------------------

.. literalinclude:: ../../samplecode/python-logging/library_logger/root_logging_yamlconfig.py
    :language: python
    :lines: 16-19

.. https://nikkie-ftnext.hatenablog.com/entry/configure-python-librarys-logger-logging-config-dict-or-yaml

3ï¸âƒ£ æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª logging ä»¥å¤–ã®é¸æŠè‚¢
======================================================================

`vinta/awesome-pythonã®Logging <https://github.com/vinta/awesome-python?tab=readme-ov-file#logging>`__ ã«ãƒªã‚¹ãƒˆ

* loguru
* structlog

IMOï¼šãã‚Œãã‚Œæˆ‘ã®å¼·ã„ä¸–ç•Œè¦³ã‚’æŒã£ã¦ã„ã‚‹

.. _loguru: https://github.com/Delgan/loguru

`loguru`_
--------------------------------------------------

    Python logging made (stupidly) simple

* HTTPX ã® logging ã‚’ä½¿ã£ãŸãƒ­ã‚°ã‚’ loguru ã§å‡ºåŠ›ã§ãã¾ã™
* `Entirely compatible with standard logging <https://github.com/Delgan/loguru/tree/0.7.3?tab=readme-ov-file#entirely-compatible-with-standard-logging>`__ ã‚ˆã‚Šã€*InterceptHandler* ã‚’å®Ÿè£…ã—ã¦ã€ãƒ«ãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒ©ã«è¨­å®šï¼ˆæ¬¡é ï¼‰

.. revealjs-break::
    :notitle:

.. literalinclude:: ../../samplecode/python-logging/library_logger/loguru_example.py
    :language: python
    :lines: 18-37
    :caption: `loguru ã§ãƒ­ã‚®ãƒ³ã‚°ã™ã‚‹ä¾‹ <https://github.com/ftnext/2025-slides/blob/f3901a2f5d7fa3bdf3f11e0c83c515781d51c116/samplecode/python-logging/library_logger/loguru_example.py>`__

.. https://nikkie-ftnext.hatenablog.com/entry/loguru-compatibility-with-stdlib-logging-example-httpx

.. _structlog: https://github.com/hynek/structlog

`structlog`_
--------------------------------------------------

    Simple, powerful, and fast logging for Python.

* æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª logging ã‹ã‚‰ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ãŒã€`äº’æ›ã§ã‚‚ã‚ã‚‹ <https://www.structlog.org/en/stable/standard-library.html#suggested-configurations>`__ ï¼ˆ*structlog.stdlib.ProcessorFormatter*ï¼‰
* PyCon JP 2024ã€Œ`å®Ÿè·µstructlog <https://2024.pycon.jp/en/talk/RRRAAT>`__ã€

.. revealjs-break::
    :notitle:

.. literalinclude:: ../../samplecode/python-logging/library_logger/structlog_example.py
    :language: python
    :lines: 23-39,49-55
    :caption: `structlog ã§ãƒ­ã‚®ãƒ³ã‚°ã™ã‚‹ä¾‹ <https://github.com/ftnext/2025-slides/blob/f3901a2f5d7fa3bdf3f11e0c83c515781d51c116/samplecode/python-logging/library_logger/structlog_example.py>`__

.. https://nikkie-ftnext.hatenablog.com/entry/structlog-integration-with-stdlib-logging-example-httpx

One more thing
======================================================================

:command:`uvx --with happy-python-logging[flake8] flake8`
----------------------------------------------------------------------

* è‡ªä½œ https://pypi.org/project/happy-python-logging/
* ``logging.basicConfig()`` ã®ä½¿ç”¨ã‚’ **ãƒªãƒ³ã‚¿ãƒ¼ã§æŒ‡æ‘˜** ã™ã‚‹æ¡ˆã®å®Ÿè£…ã«ç€æ‰‹
