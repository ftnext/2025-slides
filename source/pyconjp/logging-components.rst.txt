Chapter 1: loggingãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ§‹æˆè¦ç´ 
======================================================================

* ãƒ­ã‚¬ãƒ¼
* ãƒãƒ³ãƒ‰ãƒ©
* ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿
* ãƒ•ã‚£ãƒ«ã‚¿

HTTPXã‚’ä¾‹ã«ã€å®Ÿéš›ã®ãƒ­ã‚°ã‚’è¦‹ãªãŒã‚‰æ§‹æˆè¦ç´ ã‚’ç´¹ä»‹
--------------------------------------------------

.. ref: https://nikkie-ftnext.hatenablog.com/entry/configure-python-librarys-logger

.. literalinclude:: ../../samplecode/python-logging/library_logger/httpx_logging.py
    :language: python
    :lines: 10-12,23-25
    :caption: ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ [#pep723]_

.. [#pep723] `PyCon JP 2024 ã§è©±ã—ãŸ inline script metadata <https://2024.pycon.jp/ja/talk/89F3RQ>`__ ã‚’ä½¿ã£ã¦ã„ã¾ã™

ãƒ­ã‚¬ãƒ¼
======================================================================

* ãƒ©ã‚¤ãƒ–ãƒ©ãƒª **ä½œè€…** ã¯ãƒ­ã‚¬ãƒ¼ã‚’ä½¿ã£ã¦ **ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨˜éŒ²** ã™ã‚‹
* ã‚¤ãƒ™ãƒ³ãƒˆã®é‡è¦æ€§ï¼ˆãƒ¬ãƒ™ãƒ«ï¼‰ + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

HTTPXã®ä¸­ã«ã‚ã‚‹ãƒ­ã‚®ãƒ³ã‚°
--------------------------------------------------

.. code-block:: python
    :caption: INFOãƒ¬ãƒ™ãƒ«ã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨˜éŒ² [#httpx-guide-logging]_

    class Client(BaseClient):
        def _send_single_request(self, request: Request) -> Response:
            logger.info(
                'HTTP Request: %s %s "%s %d %s"',
                request.method,
                request.url,
                response.http_version,
                response.status_code,
                response.reason_phrase,
            )

https://github.com/encode/httpx/blob/0.28.1/httpx/_client.py#L1025

.. [#httpx-guide-logging] https://www.python-httpx.org/logging/

ãƒ­ã‚°ã®ãƒ¬ãƒ™ãƒ« [#level-table-ref]_
--------------------------------------------------

.. [#level-table-ref] `logging ã‚’ä½¿ã†ã¨ãï¼ˆåŸºæœ¬ logging ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ï¼‰ <https://docs.python.org/ja/3/howto/logging.html#when-to-use-logging>`__

.. list-table::

    * - ãƒ¬ãƒ™ãƒ«
      - ãƒ¡ã‚½ãƒƒãƒ‰
      - ã„ã¤ä½¿ã†ã‹
    * - DEBUG
      - ``debug()``
      - ãŠã‚‚ã«å•é¡Œã‚’è¨ºæ–­ã™ã‚‹ã¨ãã«ã®ã¿é–¢å¿ƒãŒã‚ã‚‹ã‚ˆã†ãªã€è©³ç´°ãªæƒ…å ±ã€‚
    * - INFO
      - ``info()``
      - æƒ³å®šã•ã‚ŒãŸé€šã‚Šã®ã“ã¨ãŒèµ·ã“ã£ãŸã“ã¨ã®ç¢ºèªã€‚

.. revealjs-break::
    :notitle:

.. list-table::

    * - WARNING
      - ``warning()``
      - æƒ³å®šå¤–ã®ã“ã¨ãŒèµ·ã“ã£ãŸã€ã¾ãŸã¯å•é¡ŒãŒè¿‘ãèµ·ã“ã‚Šãã†ã§ã‚ã‚‹ã“ã¨ã®è¡¨ç¤ºã€‚
    * - ERROR
      - ``error()``
      - ã‚ˆã‚Šé‡å¤§ãªå•é¡Œã«ã‚ˆã‚Šã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒã‚ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè¡Œã§ããªã„ã“ã¨ã€‚
    * - CRITICAL
      - ``critical()``
      - ãƒ—ãƒ­ã‚°ãƒ©ãƒ è‡ªä½“ãŒå®Ÿè¡Œã‚’ç¶šã‘ã‚‰ã‚Œãªã„ã“ã¨ã‚’è¡¨ã™ã€é‡å¤§ãªã‚¨ãƒ©ãƒ¼ã€‚

.. ãƒ­ã‚®ãƒ³ã‚°ãƒ¬ãƒ™ãƒ« https://docs.python.org/ja/3/library/logging.html#logging-levels
    ãƒ¬ãƒ™ãƒ«ã‚’è¿½åŠ ã™ã‚‹äººå‘ã‘ï¼Ÿ

ãƒ­ã‚¬ãƒ¼ã®å–å¾—ã« ``logging.getLogger()``
--------------------------------------------------

.. code-block:: python
    :caption: httpxãƒ­ã‚¬ãƒ¼ã‚’å–å¾—

    logger = logging.getLogger("httpx")

https://github.com/encode/httpx/blob/0.28.1/httpx/_client.py#L117

ãƒ©ã‚¤ãƒ–ãƒ©ãƒª **ãƒ¦ãƒ¼ã‚¶** ãŒãƒ­ã‚°ã‚’ **è¦‹ã‚‹** ã«ã¯
======================================================================

.. code-block:: python
    :caption: ã“ã®INFOãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚°ã‚’è¦‹ãŸã„

    logger = logging.getLogger("httpx")

    class Client(BaseClient):
        def _send_single_request(self, request: Request) -> Response:
            logger.info(
                'HTTP Request: %s %s "%s %d %s"',
                request.method,
                request.url,
                response.http_version,
                response.status_code,
                response.reason_phrase,
            )

.. TODO ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ %s ã§å¤‰æ•°åãŒåŸ‹ã‚ã‚‰ã‚Œã‚‹è©±ï¼ˆå®Ÿã¯f-stringã¯ä½¿ã‚ãªã„ï¼‰

HTTPXã«ä»•è¾¼ã¾ã‚ŒãŸãƒ­ã‚°ã‚’è¦‹ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰
--------------------------------------------------

.. literalinclude:: ../../samplecode/python-logging/library_logger/httpx_logging.py
    :language: python
    :lines: 13-21

ãƒ¦ãƒ¼ã‚¶ã‚‚ãƒ­ã‚¬ãƒ¼ã‚’å–å¾—
--------------------------------------------------

* ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¦ãƒ¼ã‚¶ã‚‚éƒ½åº¦ ``getLogger`` [#singleton]_

.. [#singleton] ãƒ­ã‚¬ãƒ¼ã¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ï¼ˆ`ã€Œé¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³ã€ã®ã€Œãƒ­ã‚¬ãƒ¼ã‚’ã‚¯ãƒ©ã‚¹ã®å±æ€§ã«ã™ã‚‹ã‹ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¸¡ã™ã€ <https://docs.python.org/ja/3/howto/logging-cookbook.html#using-loggers-as-attributes-in-a-class-or-passing-them-as-parameters>`__ï¼‰

.. literalinclude:: ../../samplecode/python-logging/library_logger/httpx_logging.py
    :language: python
    :lines: 13-14
    :emphasize-lines: 1

ãƒ­ã‚¬ãƒ¼ã® **ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š**
--------------------------------------------------

* `setLevel <https://docs.python.org/ja/3/library/logging.html#logging.Logger.setLevel>`__ ã—ãŸãƒ¬ãƒ™ãƒ«ä»¥ä¸Šã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨˜éŒ²ã€æœªæº€ã¯ç„¡è¦–
* ä»Šå›ã¯ ``DEBUG`` ãƒ¬ãƒ™ãƒ«ä»¥ä¸Šã®ãƒ­ã‚°ã‚’è¦‹ã‚‹ï¼ˆ``INFO`` å«ã‚€ï¼‰

.. literalinclude:: ../../samplecode/python-logging/library_logger/httpx_logging.py
    :language: python
    :lines: 13-14
    :emphasize-lines: 2

ğŸ“Œãƒ­ã‚¬ãƒ¼ã¯ **ãƒ¬ãƒ™ãƒ«ä»¥ä¸Š** ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ **è¨˜éŒ²**
--------------------------------------------------

.. list-table:: ``WARNING`` ãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚¬ãƒ¼ ``logger``

    * - ``logger.warning("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")``
      - è¨˜éŒ²ã™ã‚‹ï¼ˆãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼‰
    * - ``logger.info("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")``
      - ç„¡è¦–

**å‡ºåŠ›å…ˆ** ã‚’è¨­å®š - ãƒãƒ³ãƒ‰ãƒ©
--------------------------------------------------

.. literalinclude:: ../../samplecode/python-logging/library_logger/httpx_logging.py
    :language: python
    :lines: 16,21
    :caption: ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å‡ºåŠ›ã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©ã‚’ãƒ­ã‚¬ãƒ¼ã«å–ã‚Šä»˜ã‘

.. code-block:: txt
    :caption: httpxãƒ­ã‚¬ãƒ¼ã«ã‚ˆã‚‹ãƒ­ã‚°ãŒè¦‹ãˆã¾ã™ï¼

    % uv run example.py
    HTTP Request: GET https://peps.python.org/api/peps.json "HTTP/1.1 200 OK"

.. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ›¸å¼è¨­å®šãŒ %(message)s
    _defaultFormatter = Formatter() https://github.com/python/cpython/blob/3.13/Lib/logging/__init__.py#L734
    https://github.com/python/cpython/blob/3.13/Lib/logging/__init__.py#L446

ãƒãƒ³ãƒ‰ãƒ©ãŒãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›å…ˆã«æŒ¯ã‚Šåˆ†ã‘ã‚‹
--------------------------------------------------

* ã‚¹ãƒˆãƒªãƒ¼ãƒ 
* ãƒ•ã‚¡ã‚¤ãƒ«
* ãªã©ãªã©

**è¦‹ãŸç›®ã®è¨­å®š** - ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿
--------------------------------------------------

* ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãŒãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ã«æ›¸å¼ã‚’é©ç”¨ã—ã€ãã‚Œã‚’ãƒãƒ³ãƒ‰ãƒ©ãŒå‡ºåŠ›

.. literalinclude:: ../../samplecode/python-logging/library_logger/httpx_logging.py
    :language: python
    :lines: 17-20

æ›¸å¼ã¯ **ãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å±æ€§å** ã‚’æŒ‡å®š
--------------------------------------------------

.. literalinclude:: ../../samplecode/python-logging/library_logger/httpx_logging.py
    :language: python
    :lines: 18

.. code-block:: txt

    2025-09-24 23:38:25,370 | INFO (httpx) | _client.py:_send_single_request:1025 - HTTP Request: GET https://peps.python.org/api/peps.json "HTTP/1.1 200 OK"

`LogRecord å±æ€§ <https://docs.python.org/ja/3/library/logging.html#logrecord-attributes>`__

.. revealjs-break::
    :notitle:

.. list-table:: å±æ€§å

    * - asctime
      - ãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ç”Ÿæˆæ™‚åˆ»
    * - levelname
      - æ–‡å­—ã®ãƒ­ã‚®ãƒ³ã‚°ãƒ¬ãƒ™ãƒ«
    * - name
      - ãƒ­ã‚¬ãƒ¼ã®åå‰
    * - filename
      - ãƒ•ã‚¡ã‚¤ãƒ«å
    * - funcName
      - é–¢æ•°å
    * - lineno
      - è¡Œç•ªå·
    * - message
      - ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã“ã“ã§ã¯åå‰ã ã‘ã€‚3ç« ã§ç™»å ´ï¼‰
--------------------------------------------------

* ãƒ­ã‚¬ãƒ¼ã‚„ãƒãƒ³ãƒ‰ãƒ©ã«å–ã‚Šä»˜ã‘ã‚‹
* ãƒ•ã‚£ãƒ«ã‚¿ã«ãƒ­ã‚¬ãƒ¼ã®åå‰ã‚’æŒ‡å®šã—ã€æŒ‡å®šã—ãŸãƒ­ã‚¬ãƒ¼ã¨ *å­ã®ãƒ­ã‚¬ãƒ¼* ã®ãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ã ã‘ã‚’é€šã™

ã¾ã¨ã‚ğŸ¥Ÿ loggingãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ§‹æˆè¦ç´ 
======================================================================

* HTTPXã®ãƒ­ã‚°ã‚’è¦‹ãŸ
* ãƒ©ã‚¤ãƒ–ãƒ©ãƒª **ä½œè€…** ãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’ **è¨˜éŒ²**
* ãƒ©ã‚¤ãƒ–ãƒ©ãƒª **ãƒ¦ãƒ¼ã‚¶** ãŒ **ãƒ­ã‚°ã‚’è¦‹ã‚‹**

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œè€…ãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨˜éŒ²ğŸ¥Ÿ
--------------------------------------------------

.. image:: ../_static/pyconjp/pyconjp-library-creator-logger.drawio.png
    :scale: 150%

* ã‚¤ãƒ™ãƒ³ãƒˆã® **ãƒ¬ãƒ™ãƒ«** ã¨ **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** ã‚’æŒ‡å®šã—ã¦ã€ãƒ­ã‚¬ãƒ¼ã‚’æ“ä½œ

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¦ãƒ¼ã‚¶ãŒãƒ­ã‚°ã‚’è¦‹ã‚‹ğŸ¥Ÿ
--------------------------------------------------

.. image:: ../_static/pyconjp/pyconjp-library-user-logger.drawio.png
    :scale: 150%

* ãƒ­ã‚¬ãƒ¼ã«ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š
* ãƒ­ã‚¬ãƒ¼ã« **ãƒãƒ³ãƒ‰ãƒ©** ã‚’å–ã‚Šä»˜ã‘ã‚‹
* ãƒãƒ³ãƒ‰ãƒ©ã« **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿** ã‚’å–ã‚Šä»˜ã‘ã‚‹

.. TODO ãƒ­ã‚¬ãƒ¼ã¨ãƒãƒ³ãƒ‰ãƒ©ã«ãƒ•ã‚£ãƒ«ã‚¿ã€ã¾ãŸãƒ¬ãƒ™ãƒ«
