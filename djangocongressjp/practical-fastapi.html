<!DOCTYPE html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>FastAPI ã®ç¾å ´ã‹ã‚‰</title>
    <link rel="stylesheet" type="text/css" href="../_static/revealjs/dist/reveal.css?v=d4488b42" />
    <link rel="stylesheet" href="../_static/revealjs/dist/theme/black.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/revealjs/plugin/highlight/zenburn.css?v=83d5745d" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/common.css?v=b04cc698" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-revealjs/css/footnotes.css?v=c46a0db2" />
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@ftnext">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ftnext.github.io/2025-slides/djangocongressjp/practical-fastapi.html">
    <meta property="og:title" content="FastAPIã®ç¾å ´ã‹ã‚‰">
    <meta property="og:description" content="DjangoCongress JP 2025">
    <meta property="og:image" content="https://ftnext.github.io/2025-slides/_static/ogps/djangocongressjp.png">

  </head><body>
    <div class="reveal">
        <div class="slides" role="main">
            <section>
<section>
<h1 style="word-break: keep-all; overflow-wrap: break-word;"><strong>FastAPI</strong> ã®ç¾å ´ã‹ã‚‰</h1>
<dl class="field-list simple">
<dt class="field-odd">Event<span class="colon">:</span></dt>
<dd class="field-odd"><p>DjangoCongress JP 2025</p>
</dd>
<dt class="field-even">Presented<span class="colon">:</span></dt>
<dd class="field-even"><p>2025/02/22ğŸˆ nikkie</p>
</dd>
</dl>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">ãŠå‰ã€èª°ã‚ˆ</h2>
<ul class="simple">
<li><p>nikkieï¼ˆã«ã£ããƒ¼ï¼‰ â€»æœ¬ç™ºè¡¨ã¯å€‹äººã®è¦‹è§£ã§ã™</p></li>
<li><p><strong>æ©Ÿæ¢°å­¦ç¿’</strong> ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢</p></li>
<li><p>ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¨ã—ã¦ä¾¡å€¤ã‚’å±Šã‘ã‚‹ãŸã‚ã« <strong>Web APIã®é–‹ç™ºã‚‚</strong> ã—ã¾ã™ï¼ˆä»Šå›FastAPIã®çŸ¥è¦‹ã‚’å…±æœ‰ï¼‰</p></li>
</ul>
<img alt="../_images/uzabase-white-logo.png" src="../_images/uzabase-white-logo.png"/>
</section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">ãŠå‰ã€èª°ã‚ˆ</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://nikkie-ftnext.hatenablog.com/" rel="noreferrer" target="_blank">ãƒ–ãƒ­ã‚°</a> é€£ç¶š <strong>820</strong> æ—¥çªç ´</p></li>
<li><p><span class="fab fa-github"></span> <a class="reference external" href="https://github.com/ftnext" rel="noreferrer" target="_blank">@ftnext</a> ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã§ä½¿ã£ã¦ã‚‹ <a class="reference external" href="https://github.com/ftnext/sphinx-new-tab-link" rel="noreferrer" target="_blank">ftnext/sphinx-new-tab-link</a> ãªã©</p></li>
<li><p>2023å¹´ã«æ‚ªã„ã“ã¨ã—ã¾ã—ãŸ <a class="reference external" href="https://ftnext.github.io/2023-slides/djangocongressjp/learn-vulnerabilities.html" rel="noreferrer" target="_blank">Djangoã‚¢ãƒ—ãƒªã«ä½œã‚Šè¾¼ã‚“ã§å­¦ã¶è„†å¼±æ€§</a></p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã€ã”å­˜çŸ¥ã§ã™ã‹ï¼Ÿ</h2>
<ul class="simple">
<li><p>èã„ãŸã“ã¨ãŒã‚ã‚‹ğŸ™‹â€â™‚ï¸</p></li>
<li><p>ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹ğŸ™‹â€â™€ï¸</p></li>
</ul>
<p>ãƒˆãƒ¼ã‚¯14æœ¬ä¸­FastAPIãŒç™»å ´ã—ãã†ãªã®ã¯ä»–ã«1æœ¬</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Pythonã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«ãŠã‘ã‚‹FastAPI</h3>
<p><a class="reference external" href="https://lp.jetbrains.com/python-developers-survey-2023/#frameworks-and-libraries" rel="noreferrer" target="_blank">Python Developers Survey 2023</a> ã‚ˆã‚Š</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ ç¬¬3ä½</h3>
<img alt="../_images/survey-2023-web-framewarks.drawio.png" src="../_images/survey-2023-web-framewarks.drawio.png"/>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;"><strong>ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹</strong> ã§ä½¿ã‚ã‚Œã‚‹</h3>
<a class="reference internal image-reference" href="../_images/survey-2023-data-science-web.drawio.png"><img alt="../_images/survey-2023-data-science-web.drawio.png" src="../_images/survey-2023-data-science-web.drawio.png" style="width: 731.2px; height: 547.2px;"/>
</a>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">FastAPI</h2>
<div class="literal-block-wrapper docutils container" id="id65">
<div class="code-block-caption"><span class="caption-text">Tutorialã® <a class="reference external" href="https://fastapi.tiangolo.com/tutorial/first-steps/" rel="noreferrer" target="_blank">First Steps</a></span></div>
<pre><code class="python" data-noescape="" data-trim="">from fastapi import FastAPI

app = FastAPI()


@app.get("/")
async def root():
    return {"message": "Hello World"}
</code></pre>
</div>
<p>Djangoã® <code class="file docutils literal notranslate"><span class="pre">urls.py</span></code> ã®ã¨ã“ã‚ã®è©±</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">path <code class="docutils literal notranslate"><span class="pre">/</span></code> ã« GET <code class="docutils literal notranslate"><span class="pre">operation</span></code> ãŒæ¥ãŸã‚‰</h3>
<pre data-id="path-get-operation"><code class="python" data-line-numbers="6" data-noescape="" data-trim="">from fastapi import FastAPI

app = FastAPI()


@app.get("/")
async def root():
    return {"message": "Hello World"}
</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;"><code class="docutils literal notranslate"><span class="pre">root</span></code> é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™</h3>
<pre data-id="root"><code class="python" data-line-numbers="7,8" data-noescape="" data-trim="">from fastapi import FastAPI

app = FastAPI()


@app.get("/")
async def root():
    return {"message": "Hello World"}
</code></pre>
<p>ã“ã®å»¶é•·ã«æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’ã‚µãƒ¼ãƒ–ã™ã‚‹API</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ä»–æ–¹ Django REST Framework</h3>
<div class="literal-block-wrapper docutils container" id="id66">
<div class="code-block-caption"><span class="caption-text"><a class="reference external" href="https://www.django-rest-framework.org/tutorial/quickstart/" rel="noreferrer" target="_blank">Quickstart</a> ã«ã‚ã‚‹ <strong>èªè¨¼ä»˜ãAPI</strong></span></div>
<pre><code class="txt" data-noescape="" data-trim="">bash: curl -u admin -H 'Accept: application/json; indent=4' http://127.0.0.1:8000/users/
Enter host password for user 'admin':
{
    "count": 1,
    "next": null,
    "previous": null,
    "results": [
        {
            "url": "http://127.0.0.1:8000/users/1/",
            "username": "admin",
            "email": "admin@example.com",
            "groups": []
        }
    ]
}</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">è¨˜äº‹ <a class="reference external" href="https://www.david-dahan.com/blog/comparing-fastapi-and-django" rel="noreferrer" target="_blank">Django vs. FastAPI, An Honest Comparison</a></h3>
<ul class="simple">
<li><p>Batteries includedã‹ã€ <strong>è‡ªåˆ†ã§çµ„ã¿åˆã‚ã›ã‚‹</strong> å¿…è¦ãŒã‚ã‚‹ã‹</p></li>
<li><p>éåŒæœŸå¯¾å¿œã®åº¦åˆã„ï¼ˆéƒ¨åˆ†çš„ã‹ã€fullyã‹ï¼‰</p></li>
<li><p>IMOï¼šãã‚Œãã‚Œå¾—æ„åˆ†é‡ãŒç•°ãªã‚‹</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã®ç¾å ´ã‹ã‚‰</h2>
<ul class="simple">
<li><p>ç¤¾å†…å‘ã‘ã® <strong>å°ã•ãªWeb API</strong> ã‚’ãƒãƒ¼ãƒ ã§é–‹ç™ºï¼ˆèªè¨¼æ©Ÿèƒ½ã¯ãªã—ï¼‰</p></li>
<li><p>FastAPIã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’çš†ã§å‚ç…§ã—ãªãŒã‚‰</p></li>
<li><p>è¦‹èãã—ã¦ã„ãŸPyConã®ãƒˆãƒ¼ã‚¯ã‚‚æ‰‹ãŒã‹ã‚Šã«ï¼ˆğŸ‘‰ä»Šå›ã®çŸ¥è¦‹å…±æœ‰ã€‚ç†ŸçŸ¥ã¯ã—ã¦ãªã„ã§ã™ï¼‰</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">æ‰‹ãŒã‹ã‚Šï¼ˆå€‹ã€…ã«å–ã‚Šä¸Šã’ã¾ã™ï¼‰ğŸƒâ€â™‚ï¸</h3>
<ul class="simple">
<li><p>è¨˜äº‹ <a class="reference external" href="https://www.rhoboro.com/2021/06/12/async-fastapi-sqlalchemy.html" rel="noreferrer" target="_blank">FastAPI+SQLAlchemyã§éåŒæœŸWebAPI</a></p></li>
<li><p><a class="reference external" href="https://2021.pycon.jp/time-table?id=272415" rel="noreferrer" target="_blank">PyCon JP 2021: Python x DDD!!</a></p></li>
<li><p><a class="reference external" href="https://2024.pycon.jp/ja/talk/MXKU77" rel="noreferrer" target="_blank">PyCon JP 2024: SQLModelå…¥é–€</a></p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">å¤–éƒ¨ã®LLMã® <strong>API</strong> ã‚’ä½¿ã†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h3>
<div class="literal-block-wrapper docutils container" id="id67">
<div class="code-block-caption"><span class="caption-text"><a class="reference external" href="https://blog.hirokiky.org/entry/2023/03/14/163203" rel="noreferrer" target="_blank">ChatGPTã‚’éåŒæœŸã§Pythonã‹ã‚‰åˆ©ç”¨ã™ã‚‹æ–¹æ³•</a> (2023æ™‚ç‚¹)</span></div>
<pre><code class="python" data-noescape="" data-trim="">class GPTView(View):
    async def post(request):
        res = await openai.ChatCompletion.acreate({...})</code></pre>
</div>
<ul class="simple">
<li><p><strong>éåŒæœŸIO</strong> ãŒæœ‰åŠ¹ã€‚çš†ã‚„ã£ã¦ã¿ãŸã•ãŒã‚ã‚Šã€FastAPIã‚’é¸æŠ</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">å°ã•ã„å˜ä½ã§ <strong>éƒ½åº¦è¨­è¨ˆ</strong> ã—ãªãŒã‚‰é€²ã‚ã¦ã„ã¾ã™</h3>
<ul class="simple">
<li><p>æœ€åˆã«å…¨æ©Ÿèƒ½è¨­è¨ˆã—ãŸã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“</p></li>
<li><p><strong>path 1ã¤ã€operation 1ã¤</strong> ã«çµã£ã¦ï¼ˆæ—¢å­˜ã‚’æ‹¡å¼µã™ã‚‹ã‚ˆã†ï¼‰è¨­è¨ˆã—ã€å®Ÿè£…</p></li>
<li><p>ã“ã‚Œã‚’ç¹°ã‚Šè¿”ã™ã€‚ <strong>ãã®æ™‚ç‚¹ã®æœ€é©è§£</strong> ã‚’æ›´æ–°ã—ã¦ã„ã</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">XPï¼ˆeXtreme Programmingï¼‰ğŸƒâ€â™‚ï¸</h3>
<ul class="simple">
<li><p>ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™ºã®1æ‰‹æ³•</p></li>
<li><p>å°ã•ã„ä¾¡å€¤ã§ã‚‚å±Šã‘ã€ãã“ã‹ã‚‰ã®å­¦ã³ã‚’æ´»ã‹ã™ <strong>ã‚µã‚¤ã‚¯ãƒ«</strong> ã‚’ä½•åº¦ã‚‚ä½•åº¦ã‚‚å›ã™ï¼ˆä»Šå›ã®APIã¯3ãƒ¶æœˆçµŒéï¼‰</p></li>
<li><p>å¯¾è±¡ã® <em>ãƒ‰ãƒ¡ã‚¤ãƒ³</em> ã‚„ä½¿ã£ã¦ã„ã‚‹æŠ€è¡“ã®ç†è§£ãŒå°‘ã—ãšã¤å¢—ãˆã¦ã„ã</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">é–‹ç™ºã®æµã‚Œ</h3>
<ul class="simple">
<li><p>é–‹ç™ºå˜ä½ï¼šãƒ¦ãƒ¼ã‚¶ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</p></li>
<li><p>å®Œäº†æ¡ä»¶ã¨ãªã‚‹å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆ<strong>ATDD</strong>ï¼‰</p></li>
<li><p>æ—¢å­˜å®Ÿè£…ã‚’æ‹¡å¼µã™ã‚‹è¨­è¨ˆã‚’è€ƒãˆã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆ&amp;ãƒšã‚¢ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼‰ã§å®Ÿè£…</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">åŒåƒšã«ã‚ˆã‚‹ğŸƒâ€â™‚ï¸</h3>
<iframe allowfullscreen="true" class="speakerdeck-iframe" data-ratio="1.7777777777777777" frameborder="0" src="https://speakerdeck.com/player/f4d5c3d15476469591749e0597f4fd36?slide=16" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" title="å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ä¸ç¢ºå®Ÿæ€§ã«æ®µéšçš„ã«å¯¾å‡¦ã™ã‚‹/Addressing Uncertainty Incrementally with Acceptance Test-Driven-Development"></iframe></section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¯ <strong>Kubernetes</strong></h3>
<ul class="simple">
<li><p>ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãªAPIç¾¤</p></li>
<li><p>ä»Šå›ã®FastAPIã‚¢ãƒ—ãƒªã‚‚ã‚³ãƒ³ãƒ†ãƒŠåŒ–</p></li>
<li><p>GKEã«ãƒ‡ãƒ—ãƒ­ã‚¤</p></li>
</ul>
<p>ç§ãŒæš—é»™ã®å‰æã«ã—ã¦ã‚‹ã‹ã‚‚</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h3>
<ul class="simple">
<li><p>æ›¸ç±ã‚¢ãƒ—ãƒª</p></li>
<li><p><a class="reference external" href="https://github.com/iktakahiro/dddpy" rel="noreferrer" target="_blank">iktakahiro/dddpy</a> ã®ä¸€éƒ¨ã‚’å†å®Ÿè£…ï¼ˆä¸€è¦§ã¨ä½œæˆã®ã¿ï¼‰</p></li>
<li><p><a class="reference external" href="https://github.com/ftnext/fastapi-playground/tree/djangocongressjp-2025-v1/book-app/api" rel="noreferrer" target="_blank">https://github.com/ftnext/fastapi-playground/tree/djangocongressjp-2025-v1/book-app/api</a></p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãŠå“æ›¸ãï¼šFastAPIã®ç¾å ´ã‹ã‚‰</h3>
<ol class="arabic simple">
<li><p><strong>éåŒæœŸIO</strong></p></li>
<li><p>ã‚¯ãƒªãƒ¼ãƒ³ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å¿—å‘ã™ã‚‹</p></li>
<li><p>Twelve-Factor App</p></li>
</ol>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">éåŒæœŸIO</h2>
<ul class="simple">
<li><p>FastAPI</p></li>
<li><p>SQLModel (SQLAlchemy)</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">FastAPI</h2>
<p>Starlette + Pydantic + ä½œè€…tiangoloæ°ã®å·¥å¤«</p>
<p><a class="reference external" href="https://fastapi.tiangolo.com/features/" rel="noreferrer" target="_blank">https://fastapi.tiangolo.com/features/</a></p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">encode/starlette</h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/encode/starlette" rel="noreferrer" target="_blank">https://github.com/encode/starlette</a></p></li>
<li><p>lightweight ASGI frameworkï¼ˆéåŒæœŸIOã‚µãƒãƒ¼ãƒˆï¼‰</p></li>
<li><p><strong>é«˜ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</strong> ï¼ˆ<a class="reference external" href="https://www.techempower.com/benchmarks/#section=data-r17&amp;hw=ph&amp;test=fortune&amp;l=zijzen-1" rel="noreferrer" target="_blank">Web Framework Benchmarks</a> 0.18.0æ™‚ç‚¹ã€‚FastAPIã«ã‚‚æ©æµï¼‰</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Pydantic</h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/pydantic/pydantic" rel="noreferrer" target="_blank">https://github.com/pydantic/pydantic</a></p></li>
<li><p>å‹ãƒ’ãƒ³ãƒˆã«æ²¿ã£ã¦ <strong>ãƒ‘ãƒ¼ã‚¹</strong> ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆã€<a class="reference external" href="https://www.oreilly.co.jp/books/9784814400171/" rel="noreferrer" target="_blank">ãƒ­ãƒã‚¹ãƒˆPython</a>ã€ï¼‰</p></li>
<li><p>ã‚¨ãƒ‡ã‚£ã‚¿ã§ã®è£œå®Œã‚„ã€å®Ÿè¡Œæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã® <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code></h2>
<pre data-id="fastapi-async-def"><code class="python" data-noescape="" data-trim="">@app.get("/sync")  # path operation decorator
def path_operation_function_def():
    return {"message": "Hello World"}

@app.get("/async")
async def path_operation_function_async_def():
    return {"message": "ã©ã‚“ãªã¨ãã«async defã«ã™ã‚‹ï¼Ÿ"}</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">é›‘ãªå›ç­”</h3>
<p>ğŸ“£ã€ŒFastAPIãªã‚‰ <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> ã§ã—ã‚‡ï¼ã€</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">å‡¦ç†ã¯2ç¨®é¡ï¼ˆã€<a class="reference external" href="https://gihyo.jp/book/2020/978-4-297-11111-3" rel="noreferrer" target="_blank">Pythonå®Ÿè·µå…¥é–€</a>ã€ï¼‰</h3>
<ul>
<li><p>IOãƒã‚¦ãƒ³ãƒ‰</p>
<blockquote>
<div><ul class="simple">
<li><p>å¤–éƒ¨ã¨ã®é€šä¿¡ï¼ˆAPIã‚„DBï¼‰</p></li>
<li><p>ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã</p></li>
</ul>
</div></blockquote>
</li>
<li><p>CPUãƒã‚¦ãƒ³ãƒ‰</p>
<blockquote>
<div><ul class="simple">
<li><p>CPUã§è¨ˆç®—</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãã‚‚ãã‚‚éåŒæœŸIOãŒæœ‰åŠ¹ãªã®ã¯</h3>
<ul class="simple">
<li><p><strong>IOãƒã‚¦ãƒ³ãƒ‰</strong> ãªå‡¦ç†ï¼ˆCPUãƒã‚¦ãƒ³ãƒ‰ã§ã¯ãªã„ï¼‰</p></li>
<li><p>CPUã‚’IOå¾…ã¡ã«ã—ãªã„ã§ä»–ã®å‡¦ç†ã‚’é€²ã‚ã‚‹</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›°ã</h3>
<ul class="simple">
<li><p>éåŒæœŸIOã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ãªã‚‰ã€ãƒ‘ã‚¹ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã¯ <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code></p></li>
<li><p>Pythonã®æ–‡æ³•ã¨ã—ã¦ <code class="docutils literal notranslate"><span class="pre">await</span></code> ãŒä½¿ãˆã‚‹ã®ã¯ <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> ã®ä¸­ã ã‘</p></li>
</ul>
<pre data-id="id17"><code class="python" data-noescape="" data-trim="">client = AsyncOpenAI()

@app.get("/async")
async def use_async_support_library():
    chat_completion = await client.chat.completions.create(...)</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›°ã</h3>
<ul class="simple">
<li><p>éåŒæœŸIOã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã‚‰ã€ãƒ‘ã‚¹ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã¯ <code class="docutils literal notranslate"><span class="pre">def</span></code></p></li>
<li><p>ï¼ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°IOã§ã¯ <code class="docutils literal notranslate"><span class="pre">def</span></code></p></li>
</ul>
<pre data-id="id17"><code class="python" data-noescape="" data-trim="">@app.get("/sync")
def use_blocking_io_library():
    response = requests.get(...)</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">è³ªå•ï¼šCPUãƒã‚¦ãƒ³ãƒ‰ãªå‡¦ç†ã¯ã€ã©ã£ã¡ï¼Ÿ</h3>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã§ã¯ <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> â€¼ï¸</h3>
<blockquote>
<div><p>it's better to use <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> unless your path operation functions use code that performs blocking I/O.</p>
</div></blockquote>
<p>ã€Œãƒ‘ã‚¹ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ãŒãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°IOã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã‚ãªã„å ´åˆã€ <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> ãŒã‚ˆã„ã€</p>
<p><a class="reference external" href="https://fastapi.tiangolo.com/async/#path-operation-functions" rel="noreferrer" target="_blank">https://fastapi.tiangolo.com/async/#path-operation-functions</a></p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã§ã®éåŒæœŸIOğŸ¥Ÿ</h3>
<ul class="simple">
<li><p><strong>éåŒæœŸIOã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦</strong>ã€ãƒ‘ã‚¹ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’ <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> ã§æ›¸ã“ã†ï¼</p></li>
<li><p>CPUãƒã‚¦ãƒ³ãƒ‰ãªå‡¦ç†ã‚‚FastAPIã§ã¯ <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> ã§æ›¸ãã¨ã‚ˆã„</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">SQLModel</h2>
<p>SQLAlchemy + Pydantic + ä½œè€…tiangoloæ°ã®å·¥å¤«</p>
<p><a class="reference external" href="https://sqlmodel.tiangolo.com/features/" rel="noreferrer" target="_blank">https://sqlmodel.tiangolo.com/features/</a></p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">é€Ÿç¿’SQLModelğŸƒâ€â™‚ï¸ (PyCon JP 2024)</h3>
<iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/x7qCG9RP7u4?si=_cwx2RHSBf0CZkxL" title="YouTube video player" width="560"></iframe><p><a class="reference external" href="https://sqlmodel.tiangolo.com/tutorial/" rel="noreferrer" target="_blank">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a> ã®å†…å®¹ã‚’30åˆ†ã§ã‚«ãƒãƒ¼ã—ã¦ã¾ã™</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ã“ã“ã§ã‚‚Pydantic</h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SQLModel</span></code> ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã¯ã€Pydanticã® <code class="docutils literal notranslate"><span class="pre">BaseModel</span></code> ã§ã‚‚ã‚ã‚‹ã®ã§ã€ <strong>FastAPIã§ä½¿ãˆã‚‹</strong></p></li>
<li><p>ORMã‚’æ‰±ã†éš›ã«ã‚‚ã‚¨ãƒ‡ã‚£ã‚¿ã§è£œå®ŒãŒåŠ¹ã</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">SQLAlchemy</h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/sqlalchemy/sqlalchemy" rel="noreferrer" target="_blank">https://github.com/sqlalchemy/sqlalchemy</a></p></li>
<li><p>ä»£è¡¨çš„ãªORM</p></li>
<li><p><strong>DBã®éåŒæœŸIO</strong> ã‚’ã‚µãƒãƒ¼ãƒˆï¼ï¼ˆã‚ã‚ŠãŒã¨ã†ï¼ï¼ï¼‰</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">DBã®éåŒæœŸIO</h2>
<ul class="simple">
<li><p><strong>SQLAlchemy</strong> ã«SQLModelã¯ä¹—ã£ã‹ã‚‹ï¼ˆSQLAlchemyã®è©±ã«ãªã‚Šã¾ã™ï¼‰</p></li>
<li><p>PostgreSQLã®ä¾‹</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">SQLModelã¨ã—ã¦</h3>
<pre data-id="id20"><code class="python" data-noescape="" data-trim="">from sqlalchemy.ext.asyncio import create_async_engine
from sqlmodel.ext.asyncio.session import AsyncSession

database_url = "postgresql+asyncpg://developer:mysecretpassword@127.0.0.1:5432/practice"
engine = create_async_engine(database_url)
async with AsyncSession(engine) as session:
    ...</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">IMOï¼š <code class="docutils literal notranslate"><span class="pre">async_sessionmaker</span></code> ã¨ã„ã„ã¨ã“å–ã‚Š</h3>
<pre data-id="imo-async-sessionmaker"><code class="python" data-noescape="" data-trim="">from sqlalchemy.ext.asyncio import async_sessionmaker, create_async_engine
from sqlmodel.ext.asyncio.session import AsyncSession as SQLModelAsyncSession

database_url = "postgresql+asyncpg://developer:mysecretpassword@127.0.0.1:5432/practice"
engine = create_async_engine(database_url)
AsyncSession = async_sessionmaker(engine, class_=SQLModelAsyncSession)
async with AsyncSession() as session:  # AsyncSession.begin() ã‚‚ã§ãã‚‹
    ...</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">SQLModelãŒæä¾›ã™ã‚‹DBã‚»ãƒƒã‚·ãƒ§ãƒ³</h3>
<pre data-id="sqlmodeldb"><code class="python" data-noescape="" data-trim="">from sqlmodel import Session
from sqlmodel.ext.asyncio.session import AsyncSession</code></pre>
<ul class="simple">
<li><p><strong>DBã¨ã®ã‚„ã‚Šå–ã‚Š</strong> ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é€šã—ã¦</p></li>
<li><p>SQLAlchemyã® <code class="docutils literal notranslate"><span class="pre">Session</span></code> ã‚„ <code class="docutils literal notranslate"><span class="pre">AsyncSession</span></code> ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">DBã‚»ãƒƒã‚·ãƒ§ãƒ³æ¯”è¼ƒ</h3>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">execute()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exec()</span></code></p></td>
</tr>
<tr class="row-even"><td><p>SQLAlchemy</p></td>
<td><p><strong>ã‚ã‚‹</strong></p></td>
<td><p>ãªã„</p></td>
</tr>
<tr class="row-odd"><td><p>SQLModel</p></td>
<td><p>ã‚ã‚‹</p></td>
<td><p><strong>ã‚ã‚‹</strong> ï¼ˆæ¨å¥¨ï¼‰</p></td>
</tr>
</tbody>
</table>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">SQLModelã®DBã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ <strong>å‹ãŒå½“ãŸã‚‹</strong></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Session</span></code> ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã« <code class="docutils literal notranslate"><span class="pre">statement</span></code> ã‚’æ¸¡ã—ã¦ã€ <code class="docutils literal notranslate"><span class="pre">exec()</span></code> ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã¶</p></li>
</ul>
<pre data-id="id21"><code class="python" data-line-numbers="3" data-noescape="" data-trim="">statement = select(Hero)
async with AsyncSession(async_engine) as session:
    results = await session.exec(statement)
    for hero in results:
        print(repr(hero))</code></pre>
<ul class="simple">
<li><p>SQLAlchemyã®Sessionã® <code class="docutils literal notranslate"><span class="pre">execute().scalars()</span></code> ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã‚“ã§å®Ÿç¾ğŸƒâ€â™‚ï¸</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;"><code class="docutils literal notranslate"><span class="pre">sessionmaker</span></code> ã®æä¾›</h3>
<dl class="field-list simple">
<dt class="field-odd">SQLAlchemy<span class="colon">:</span></dt>
<dd class="field-odd"><p>ã‚ã‚‹ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã® <strong>ãƒ•ã‚¡ã‚¯ãƒˆãƒª</strong> ã‚¯ãƒ©ã‚¹ã‚’è¿”ã™ãŸã‚ã€å¸¸ã« <code class="docutils literal notranslate"><span class="pre">engine</span></code> ã‚’æ¸¡ã—ã¦åˆæœŸåŒ–ã—ãªãã¦ã‚ˆããªã‚‹</p>
</dd>
<dt class="field-even">SQLModel<span class="colon">:</span></dt>
<dd class="field-even"><p>ãªã„ã€‚<a class="reference external" href="https://github.com/fastapi/sqlmodel/issues/75#issuecomment-1311796665" rel="noreferrer" target="_blank">tiangoloæ°</a> ã€Œå¸¸ã« <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">Session(engine)</span></code> ã™ã‚Œã°ã‚ˆã„ã€ï¼ˆIMOï¼šã›ã‚„ã‚ã‹ï¼Ÿï¼‰</p>
</dd>
</dl>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ææ¡ˆï¼šsessionmakerã§SQLModelã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¿”ã•ã›ã‚‹</h3>
<pre data-id="sessionmakersqlmodel"><code class="python" data-line-numbers="4" data-noescape="" data-trim="">from sqlalchemy.ext.asyncio import async_sessionmaker, create_async_engine
from sqlmodel.ext.asyncio.session import AsyncSession as SQLModelAsyncSession

AsyncSession = async_sessionmaker(engine, class_=SQLModelAsyncSession)</code></pre>
<ul class="simple">
<li><p>SQLModelã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ•ã‚¡ã‚¯ãƒˆãƒªãªã®ã§ <code class="docutils literal notranslate"><span class="pre">exec()</span></code> ãŒä½¿ãˆã‚‹ï¼</p></li>
<li><p>ç¾çŠ¶ã€ä¸–ã«ã¯SQLAlchemyã®ä¾‹ãŒå¤šã„ã®ã§ã€DBæ¥ç¶šéƒ¨åˆ†ã¯å‚è€ƒã«ã§ãã‚‹</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ææ¡ˆã®å‚è€ƒğŸƒâ€â™‚ï¸</h3>
<ul class="simple">
<li><p>å¤§å…ƒ <a class="reference external" href="https://github.com/fastapi/sqlmodel/issues/75#issuecomment-2109911909" rel="noreferrer" target="_blank">Add sessionmaker #75</a></p></li>
<li><p>æ‹™ãƒ–ãƒ­ã‚° <a class="reference external" href="https://nikkie-ftnext.hatenablog.com/entry/sqlmodel-postgres-sync-connection-sqlalchemy-sessionmaker-integration" rel="noreferrer" target="_blank">SQLModelç´ æŒ¯ã‚Šã®è¨˜ï¼šPostgreSQLã«åŒæœŸæ¥ç¶š ã€œselectã—ã¦è¦‹ãˆãŸã€SQLAlchemyã®sessionmakerã®class_å¼•æ•°ã«ã‚ˆã‚‹ã„ã„ã¨ã“å–ã‚Šæ¡ˆã€œ</a></p></li>
<li><p>æ‹™ãƒ–ãƒ­ã‚° <a class="reference external" href="https://nikkie-ftnext.hatenablog.com/entry/sqlmodel-postgres-async-connection-proposal-sqlalchemy-sessionmaker-integration" rel="noreferrer" target="_blank">SQLModelã§PostgreSQLã«éåŒæœŸæ¥ç¶šã™ã‚‹å®Ÿè£…ã‚’è€ƒãˆã‚‹</a></p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">IMOï¼šSQLModelæ‰€æ„Ÿ</h2>
<ul class="simple">
<li><p>SQLModelã§FastAPIã‚¢ãƒ—ãƒªã¯ <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> ã§æ›¸ã‘ã‚‹ãŒã€ã¾ã ã¾ã ç™ºå±•é€”ä¸Šï¼ˆ0.0.22ï¼‰</p></li>
<li><p><strong>SQLAlchemyã®çµŒé¨“</strong> ãŒã‚ã‚‹æ–¹ã«ã ã‘ã€ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™</p></li>
<li><p>çµŒé¨“ãªã„æˆ‘ãŒèº«ã«ã¯ã€SQLModel + SQLAlchemyã¨ <em>å­¦ã³ãŒ2å€</em> ã ã£ãŸğŸ™Œ</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">IMOï¼šSQLModelã®ç¾çŠ¶ğŸƒâ€â™‚ï¸</h3>
<ul class="simple">
<li><p>ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯toy exampleã§å®Ÿå‹™ãƒ¬ãƒ™ãƒ«ã®ä¾‹ãŒãªã„ï¼ˆãƒ—ãƒ«ãƒªã‚¯ãƒãƒ£ãƒ³ã‚¹ï¼ï¼‰</p></li>
<li><p><a class="reference external" href="https://www.david-dahan.com/blog/comparing-fastapi-and-django" rel="noreferrer" target="_blank">å…ˆã®æ¯”è¼ƒè¨˜äº‹</a> ã‚ˆã‚Šã€ã‚·ãƒ³ã‚°ãƒ«ãƒ¡ãƒ³ãƒ†ãƒŠã‚†ãˆã«åˆ¤æ–­ã‚’èª¤ã£ãŸã®ã§ã¯</p></li>
<li><p>FastAPIãƒ¦ãƒ¼ã‚¶ãŒ <strong>åˆ†æ–­</strong> ã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ï¼ˆSQLModelæ¡ç”¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¾‹ãŒè¦‹ã¤ã‹ã‚Šã«ãã„ï¼‰</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">ãŠå“æ›¸ãï¼šFastAPIã®ç¾å ´ã‹ã‚‰</h2>
<ol class="arabic simple">
<li><p>éåŒæœŸIO</p></li>
<li><p><strong>ã‚¯ãƒªãƒ¼ãƒ³ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å¿—å‘ã™ã‚‹</strong></p></li>
<li><p>Twelve-Factor App</p></li>
</ol>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">The Clean Architecture</h2>
<ul class="simple">
<li><p>Robert C. Martin (Uncle Bob) ã«ã‚ˆã‚‹ãƒ–ãƒ­ã‚°</p></li>
<li><p><a class="reference external" href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html" rel="noreferrer" target="_blank">https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html</a></p></li>
<li><p>æ°ã«ã‚ˆã‚‹æ›¸ç±ã€<a class="reference external" href="https://asciidwango.jp/post/176293765750/clean-architecture" rel="noreferrer" target="_blank">Clean Architecture</a>ã€ã¨åŒºåˆ¥ã—ã¦ã¾ã™</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">XXXã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å…±é€šã™ã‚‹ã‚‚ã®</h3>
<ul class="simple">
<li><p>Hexagonal (=Ports and Adapters) / Onion / e.t.c.</p></li>
<li><p><strong>ãƒ¬ã‚¤ãƒ¤åˆ†ã‘</strong> ã«ã‚ˆã‚‹ <strong>é–¢å¿ƒã®åˆ†é›¢</strong></p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ã€Œå…±é€šã™ã‚‹ã‚‚ã®ã€ã®æ¦‚è¦ï¼ˆschematicï¼‰</h3>
<a class="reference internal image-reference" href="../_images/uncle-bob-CleanArchitecture.jpg"><img alt="../_images/uncle-bob-CleanArchitecture.jpg" src="../_images/uncle-bob-CleanArchitecture.jpg" style="width: 617.6px; height: 453.6px;"/>
</a>
<p>æ³¨ï¼šã“ã®4å±¤ã‚’å°å…¥ã™ã‚Œã°ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ <strong>ã§ã¯ã‚ã‚Šã¾ã›ã‚“</strong></p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">The Dependency Rule</h3>
<blockquote>
<div><p>source code dependencies can only point inwards.</p>
</div></blockquote>
<p>å„ãƒ¬ã‚¤ãƒ¤ã¯ã€è‡ªåˆ†ã‚ˆã‚Š <strong>å†…å´ã®ãƒ¬ã‚¤ãƒ¤ã ã‘ã«ä¾å­˜</strong> ã™ã‚‹</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãªãœæå”±ã•ã‚ŒãŸã®ã‹ï¼ˆç§ã®ç†è§£ï¼‰</h3>
<ul class="simple">
<li><p>ä¾‹ãˆã°ã€Djangoã®Model-View-Template</p></li>
<li><p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­å¿ƒã«ã‚ã‚‹ã®ã¯ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆDjangoãƒ»FastAPIï¼‰ã‚„å…·ä½“ã®DBã«ãªã£ã¦ã¾ã›ã‚“ã‹ï¼Ÿ</p></li>
<li><p>ãƒ¦ãƒ¼ã‚¶ä¾¡å€¤ã‚’æä¾›ã™ã‚‹ <strong>ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«</strong> ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­å¿ƒã«ç½®ããŸã„ï¼</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">The Clean Architecture ã¯</h3>
<ul class="simple">
<li><p><strong>ä¸­å¿ƒã«ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«</strong></p></li>
<li><p>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ <strong>ç‹¬ç«‹</strong> ï¼ˆå·®ã—æ›¿ãˆå¯èƒ½ï¼‰</p></li>
<li><p>è©³ç´°ã®æ±ºå®šã‚’é…ã‚‰ã›ã‚‹</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Clean Architectureã‚’å­¦ã‚“ã§ããŸé“ğŸƒâ€â™‚ï¸</h3>
<ul class="simple">
<li><p><a class="reference external" href="https://gihyo.jp/magazine/SD/archive/2023/202306" rel="noreferrer" target="_blank">Software Design 2023å¹´6æœˆå·</a> ç¬¬1ç‰¹é›†</p></li>
<li><p>ã€<a class="reference external" href="https://gihyo.jp/book/2022/978-4-297-13234-7" rel="noreferrer" target="_blank">ã¡ã‚‡ã†ãœã¤ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆå…¥é–€</a>ã€</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">ãƒ¬ã‚¤ãƒ¤åˆ†ã‘</h2>
<pre data-id="id27"><code class="txt" data-noescape="" data-trim="">src/api
â”œâ”€â”€ domain/
â”œâ”€â”€ driver/
â”œâ”€â”€ gateway/
â”œâ”€â”€ port/
â”œâ”€â”€ rest/
â””â”€â”€ use_case/</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ã“ã®ãƒ¬ã‚¤ãƒ¤åˆ†ã‘ã§å®Ÿç¾ã—ãŸã„ã“ã¨</h3>
<div class="literal-block-wrapper docutils container" id="id68">
<div class="code-block-caption"><span class="caption-text">FastAPIã®path operationé–¢æ•°ã« <code class="docutils literal notranslate"><span class="pre">use_case</span></code> ã‚’æ³¨å…¥</span></div>
<pre><code class="python" data-line-numbers="3,5" data-noescape="" data-trim="">@app.get("/books", response_model=list[BookReadModel])
async def get_books(
    use_case: Annotated[ListBooksUseCase, Depends(inject_list_books_use_case)],
):
    books = await use_case.execute()
    return [BookReadModel.from_book(book) for book in books]</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">åŒå¿ƒå††ã®å†…å´ -&gt; å¤–å´ã®å‘ãã«è¦‹ã¦ã„ãã¾ã™</h3>
<img alt="../_images/uncle-bob-CleanArchitecture.jpg" src="../_images/uncle-bob-CleanArchitecture.jpg"/>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">domain</h2>
<img alt="../_images/domain.drawio.png" src="../_images/domain.drawio.png"/>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">domain</h3>
<ul class="simple">
<li><p>åŒå¿ƒå††ã®ä¸€ç•ªå†…å´ï¼ˆå›³ã§ã¯Entitiesï¼‰</p></li>
<li><p><strong>ã‚·ã‚¹ãƒ†ãƒ ãŒãªãã¦ã‚‚å­˜åœ¨</strong> ã™ã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹ï¼šéŠ€è¡Œï¼‰</p></li>
<li><p>äº‹æ¥­é ˜åŸŸã‚’ã‚³ãƒ¼ãƒ‰ã§è¡¨ç¾ã™ã‚‹ï¼ˆ<em>ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒªãƒ³ã‚°</em> ã€‚ã“ã“ã«æ™‚é–“ã‚’ä½¿ãˆã¦ã„ã¾ã™ï¼‰</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒªãƒ³ã‚° å‚è€ƒè³‡æ–™ğŸƒâ€â™‚ï¸</h3>
<ul class="simple">
<li><p><a class="reference external" href="https://speakerdeck.com/minodriven/kusokododong-hua-userkurasu-dekao-eruji-shu-de-fu-zhai-jie-xiao-falseguan-dian" rel="noreferrer" target="_blank">ã‚¯ã‚½ã‚³ãƒ¼ãƒ‰å‹•ç”»ã€ŒUserã‚¯ãƒ©ã‚¹ã€ã§è€ƒãˆã‚‹æŠ€è¡“çš„è² å‚µè§£æ¶ˆã®è¦³ç‚¹</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/live/2mfj_yjalqk?si=VGeuDgSataYyfjaA" rel="noreferrer" target="_blank">æ¦‚å¿µæŠ•å½±ã«ã‚ˆã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨­è¨ˆã®è€ƒãˆæ–¹ã¨ãã®æ–¹æ³•</a></p></li>
<li><p><a class="reference external" href="https://speakerdeck.com/masuda220/aligning-software-architecture-and-business-strategy-2024-8-forkwill" rel="noreferrer" target="_blank">ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®å®Ÿè£…ã¨äº‹æ¥­æˆ¦ç•¥ã‚’çµã³ã¤ã‘ã‚‹</a></p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Pydanticã® <code class="docutils literal notranslate"><span class="pre">BaseModel</span></code> ã‚’ä½¿ã£ã¦å®Ÿè£…</h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frozen=True</span></code> å¤‰æ›´ã§ããªãã™ã‚‹</p></li>
</ul>
<pre data-id="pydantic-basemodel"><code class="python" data-noescape="" data-trim="">class Book(BaseModel, frozen=True):
    id: str
    isbn: ISBN
    title: str
    page: int</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Pydanticã® <code class="docutils literal notranslate"><span class="pre">BaseModel</span></code> ã‚’ä½¿ã£ã¦å®Ÿè£…</h3>
<ul class="simple">
<li><p>åŒå€¤æ€§ ï¼ˆ<code class="docutils literal notranslate"><span class="pre">__eq__()</span></code>ï¼‰</p></li>
<li><p><strong>ç‰¹æ®Šãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ </strong> ï¼ˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ä¾‹ï¼š <code class="docutils literal notranslate"><span class="pre">__iter__()</span></code> ã§ã‚¤ãƒ†ãƒ©ãƒ–ãƒ«ã«ï¼‰</p></li>
</ul>
<pre data-id="pydantic-basemodel"><code class="python" data-noescape="" data-trim="">class Books(BaseModel, frozen=True):
    values: list[Book]

    def __iter__(self) -&gt; Generator[Book, None, None]:  # type: ignore[override]
        yield from self.values</code></pre>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">usecase</h2>
<img alt="../_images/use-case.drawio.png" src="../_images/use-case.drawio.png"/>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">usecase</h3>
<ul class="simple">
<li><p>åŒå¿ƒå††ã®å†…å´ã‹ã‚‰2ç•ªç›®</p></li>
<li><p>ã‚·ã‚¹ãƒ†ãƒ ã§ <strong>äº‹æ¥­é ˜åŸŸã®èª²é¡Œã‚’è§£æ±ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯</strong> ï¼ˆï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰</p></li>
<li><p>ãƒ¡ãƒ¢ãƒªä¸Šã§ã¯å®Œç’§ã«æ§‹ç¯‰ï¼ˆIOãªã©ã¯ãªã„ã®ã§ä½¿ãˆãªã„ï¼‰</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">usecaseãŒçŸ¥ã£ã¦ã„ã‚‹ã‚‚ã®ï¼ˆå†…å´ã®ã¿ï¼‰</h3>
<ul class="simple">
<li><p>usecaseã¯å†…å´ã®domainã‚’çŸ¥ã£ã¦ã„ã‚‹</p></li>
<li><p>usecaseã¯ <em>port</em> ã‚‚çŸ¥ã£ã¦ã„ã‚‹ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ã¯å‘¼ã³å‡ºã›ã‚‹ï¼‰</p></li>
</ul>
<pre data-id="id33"><code class="python" data-noescape="" data-trim="">await self.fetch_books_port.fetch()</code></pre>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">port</h2>
<img alt="../_images/port.drawio.png" src="../_images/port.drawio.png"/>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">port</h3>
<ul class="simple">
<li><p><strong>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹</strong></p></li>
</ul>
<pre data-id="id34"><code class="python" data-noescape="" data-trim="">class FetchBooksPort(ABC):
    @abstractmethod
    async def fetch(self) -&gt; Books:
        raise NotImplementedError</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">usecaseã¯</h3>
<ul class="simple">
<li><p>portã® <strong>ä½¿ã„æ–¹ã‚’çŸ¥ã£ã¦ã„ã‚‹</strong> ï¼ˆä¾‹ï¼š<code class="docutils literal notranslate"><span class="pre">fetch()</span></code> ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚ã‚‹ï¼ï¼‰</p></li>
<li><p>ä¸­èº«ãŒã©ã‚“ãªå®Ÿè£…ã‚’ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆä¾‹ï¼šãƒ‡ãƒ¼ã‚¿å–å¾—ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã‹ï¼‰ã¯çŸ¥ã‚‰ãªã„</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">usecaseã«portãŒæ¸¡ã‚‹</h3>
<pre data-id="usecaseport"><code class="python" data-noescape="" data-trim="">class ListBooksUseCase:
    def __init__(self, fetch_books_port: FetchBooksPort) -&gt; None:
        self.fetch_books_port = fetch_books_port</code></pre>
<ul class="simple">
<li><p>ä½œã‚‹ã¨ä½¿ã†ã‚’ä¸€ç·’ã«ã›ãšã« <strong>åˆ†ã‘ã‚‹</strong></p></li>
<li><p>usecaseã¯ <strong>ä½¿ã†ã ã‘</strong> ï¼ˆ<em>ä¾å­˜æ€§ã®é€†è»¢</em>ï¼‰</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">gateway</h2>
<img alt="../_images/gateway.drawio.png" src="../_images/gateway.drawio.png"/>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">gateway</h3>
<ul class="simple">
<li><p>portã‚’å®Ÿè£…ã™ã‚‹</p></li>
<li><p>usecaseã«ã¯ï¼ˆportã‚’å®Ÿè£…ã—ãŸï¼‰gatewayã‚’æ¸¡ã™</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id69">
<div class="code-block-caption"><span class="caption-text">ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ã¨æŠ€è¡“è©³ç´°ãŒé¡”ã‚’å‡ºã™</span></div>
<pre><code class="python" data-noescape="" data-trim="">class FetchBooksFromDatabase(FetchBooksPort):</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">usecaseã¯gatewayã«ä¾å­˜ã™ã‚‹</h3>
<div class="literal-block-wrapper docutils container" id="id70">
<div class="code-block-caption"><span class="caption-text">ä½œã£ã¦ä½¿ãˆãŸã‚‰ãª...</span></div>
<pre><code class="python" data-noescape="" data-trim="">class ListBooksUseCase:
    def execute(self) -&gt; Books:
        fetch_books = FetchBooksFromDatabase()
        return await fetch_books.fetch()</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ä½œã‚‹ã¨ä½¿ã†ã‚’åˆ†ã‘ã‚‹</h3>
<div class="literal-block-wrapper docutils container" id="id71">
<div class="code-block-caption"><span class="caption-text">å¤–ã‹ã‚‰gatewayãŒæ¸¡ã£ã¦ãã‚‹ã€‚ <strong>ä½¿ã†ã ã‘</strong></span></div>
<pre><code class="python" data-noescape="" data-trim="">class ListBooksUseCase:
    def __init__(self, fetch_books: FetchBooksFromDatabase) -&gt; None:
        self.fetch_books = fetch_books

    def execute(self) -&gt; Books:
        return await self.fetch_books.fetch()</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ä¾å­˜æ€§ã®é€†è»¢ï¼ˆDIPï¼‰</h3>
<ul class="simple">
<li><p>å…·ä½“ã®gatewayã§ã¯ãªãã€portï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆ<strong>ä½¿ã„æ–¹</strong>ï¼‰ <strong>ã«ä¾å­˜</strong> ã™ã‚‹</p></li>
<li><p>usecaseã¯è©³ç´°ã¯çŸ¥ã‚‰ãªãã¦ã‚‚ä½¿ãˆã‚‹</p></li>
</ul>
<pre data-id="dip"><code class="python" data-noescape="" data-trim="">class ListBooksUseCase:
    def __init__(self, fetch_books_port: FetchBooksPort) -&gt; None:
        self.fetch_books_port = fetch_books_port

    async def execute(self) -&gt; Books:
        return await self.fetch_books_port.fetch()</code></pre>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">gatewayã§ãƒ‡ãƒ¼ã‚¿ã‚’ <strong>å¤‰æ›</strong></h2>
<ul class="simple">
<li><p>ORMï¼ˆSQLModelï¼‰ã‚’gatewayã«ç½®ã</p></li>
<li><p>å¤–ç•Œï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‹ã§è¡¨ç¾ï¼‰ã‹ã‚‰ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ã«å¤‰æ›ã™ã‚‹</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id72">
<div class="code-block-caption"><span class="caption-text">å¤–ç•Œï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰</span></div>
<pre><code class="python" data-noescape="" data-trim="">class BookRecord(SQLModel, table=True):</code></pre>
</div>
<div class="literal-block-wrapper docutils container" id="id73">
<div class="code-block-caption"><span class="caption-text">ãƒ‰ãƒ¡ã‚¤ãƒ³</span></div>
<pre><code class="python" data-noescape="" data-trim="">class Book(BaseModel, frozen=True):</code></pre>
</div>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">ã•ã‚‰ã«gatewayã§ã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã™ã‚‹</h2>
<ul class="simple">
<li><p>gatewayè‡ªèº«ã¯ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’çŸ¥ã£ã¦ã„ã‚‹</p></li>
<li><p>driverãŒå®Ÿè£…ã™ã‚‹ï¼ˆå†ã³ç™»å ´ã€ <strong>ä¾å­˜æ€§ã®é€†è»¢</strong>ï¼‰</p></li>
</ul>
<pre data-id="id39"><code class="python" data-noescape="" data-trim="">class DatabaseDriver(ABC):
    @abstractmethod
    async def select_books(self) -&gt; list[BookRecord]:
        raise NotImplementedError</code></pre>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">driver</h2>
<img alt="../_images/driver.drawio.png" src="../_images/driver.drawio.png"/>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">driver</h3>
<ul class="simple">
<li><p>ä¸€ç•ªå¤–å´</p></li>
<li><p>å¤–ç•Œã«æ¥ã™ã‚‹ï¼šHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã€DB</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">dict</span></code> ãªã©ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‹ã§æ‰±ã†ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ã§ã¯ãªã„ï¼‰</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">gatewayã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…</h3>
<div class="literal-block-wrapper docutils container" id="id74">
<div class="code-block-caption"><span class="caption-text">å…·ä½“çš„ãªæŠ€è¡“è©³ç´°ãŒç™»å ´ï¼ˆPostgreSQLï¼‰</span></div>
<pre><code class="python" data-noescape="" data-trim="">class PostgresqlDatabaseDriver(DatabaseDriver):
    async def select_books(self) -&gt; list[BookRecord]:
        # åˆæœŸåŒ–ã§æ¸¡ã•ã‚Œã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã€DBã¨ã‚„ã‚Šå–ã‚Š</code></pre>
</div>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">rest</h2>
<img alt="../_images/rest.drawio.png" src="../_images/rest.drawio.png"/>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">rest</h3>
<ul class="simple">
<li><p>ã“ã‚Œã‚‚ã¾ãŸå¤–ç•Œï¼šWeb APIã«ã—ã¦å¤–ç•Œã«æ¥ã™ã‚‹</p></li>
<li><p><strong>FastAPIã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®æ©Ÿèƒ½ã‚’æ´»ç”¨</strong> ï¼ˆHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹controllerã‚‚å…¼ã­ã‚‹ï¼‰</p></li>
<li><p>å®Ÿè£…ã§ã¯ã€Web APIã¨ã—ã¦å‹•ã‹ã™ãŸã‚ã®ä¾å­˜ã‚’æ¸¡ã—ãŸ</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">usecaseã‚’çµ„ã¿ç«‹ã¦ã‚‹</h3>
<pre data-id="id43"><code class="python" data-noescape="" data-trim="">def inject_list_books_use_case(
    session: Annotated[type[SQLModelAsyncSession], Depends(get_session)],
) -&gt; ListBooksUseCase:
    return ListBooksUseCase(FetchBooksFromDatabase(PostgresqlDatabaseDriver(session)))</code></pre>
<p>ã“ã‚Œã‚’path operationé–¢æ•°ã§å®Ÿè¡Œ</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ã‚’å®šç¾©</h3>
<ul class="simple">
<li><p><strong>ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ã‚’ç›´æ¥ã¯è¿”ã•ãªã„</strong></p></li>
<li><p>APIåˆ©ç”¨è€…ã«è¦‹ã›ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ã‚’ä½œã‚‹ï¼ˆãŸã¾ãŸã¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ã¨åŒã˜å±æ€§ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚‹ï¼‰</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">ã¾ã¨ã‚ğŸ¥Ÿ ã‚¯ãƒªãƒ¼ãƒ³ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å¿—å‘ã—ãŸãƒ¬ã‚¤ãƒ¤åˆ†ã‘</h2>
<pre data-id="id44"><code class="txt" data-noescape="" data-trim="">src/api
â”œâ”€â”€ domain/    # ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‰ãªã„ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’è¡¨ç¾
â”œâ”€â”€ use_case/  # domainã‚’æ“ä½œã—ã¦èª²é¡Œè§£æ±º
â”œâ”€â”€ port/      # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€‚use_caseãŒä¾å­˜ã—ã€gatewayã§å®Ÿè£…
â”œâ”€â”€ gateway/   # portã‚’å®Ÿè£…ã€‚ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›ã€‚driverå‘ã‘ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©
â”œâ”€â”€ driver/    # gatewayã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã€‚DBã‚„Web APIã¨æ¥ã™ã‚‹
â””â”€â”€ rest/      # Webã‚¢ãƒ—ãƒªã€‚ä»Šå›ã¯FastAPIã®æ©Ÿèƒ½ã‚’ä½¿ã£ãŸ</code></pre>
<p>ä¸Šã»ã©åŒå¿ƒå††ã®å†…å´</p>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">çŸ¥è­˜ã‚’ãƒ¬ã‚¤ãƒ¤ã«é–‰ã˜è¾¼ã‚ã‚‹ãŸã‚ã«</h2>
<p>å·¥å¤«2ã¤ã‚’å…±æœ‰ï¼ˆè­°è«–ã®ç¨®ã¨ã—ã¦ï¼‰</p>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">1ï¸âƒ£FastAPIã®Depends</h2>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">restå±¤ã§ã“ã‚ŒãŒã‚„ã‚ŠãŸã‹ã£ãŸï¼ˆå†æ²ï¼‰</h3>
<div class="literal-block-wrapper docutils container" id="id75">
<div class="code-block-caption"><span class="caption-text">path operationé–¢æ•°ã« <code class="docutils literal notranslate"><span class="pre">use_case</span></code> ã‚’æ³¨å…¥</span></div>
<pre><code class="python" data-noescape="" data-trim="">def inject_list_books_use_case(
    session: Annotated[type[SQLModelAsyncSession], Depends(get_session)],
) -&gt; ListBooksUseCase:
    return ListBooksUseCase(FetchBooksFromDatabase(PostgresqlDatabaseDriver(session)))

@app.get("/books", response_model=list[BookReadModel])
async def get_books(
    use_case: Annotated[ListBooksUseCase, Depends(inject_list_books_use_case)],
):
    books = await use_case.execute()
    return [BookReadModel.from_book(book) for book in books]</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã® <code class="docutils literal notranslate"><span class="pre">Depends</span></code> ğŸŒŸ</h3>
<p><a class="reference external" href="https://fastapi.tiangolo.com/tutorial/dependencies/" rel="noreferrer" target="_blank">https://fastapi.tiangolo.com/tutorial/dependencies/</a></p>
<pre data-id="fastapi-depends"><code class="python" data-noescape="" data-trim="">async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}

@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;"><code class="docutils literal notranslate"><span class="pre">Annotated[...,</span> <span class="pre">Depends(...)]</span></code></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">typing.Annotated[&lt;type&gt;,</span> <span class="pre">&lt;metadata&gt;]</span></code> ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä»˜ä¸</p></li>
<li><p>ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã® <code class="docutils literal notranslate"><span class="pre">Depends(é–¢æ•°)</span></code> ã¯ã€ <strong>é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦è¿”ã‚Šå€¤ã‚’å‹ãƒ’ãƒ³ãƒˆã—ã¦ã‚‹å¤‰æ•°ã«ä»£å…¥</strong></p></li>
<li><p>IMOï¼šå‹•ããŒ <a class="reference external" href="https://nikkie-ftnext.hatenablog.com/entry/sphinx-extension-e2e-app-status-warning-are-pytest-fixtures#pytest%E3%81%AE%E3%83%95%E3%82%A3%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3%E3%81%AF%E5%BC%95%E6%95%B0%E3%81%AB%E3%81%82%E3%82%8B%E5%88%A5%E3%81%AE%E3%83%95%E3%82%A3%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%A7%E3%81%8D%E3%82%8B" rel="noreferrer" target="_blank">pytestã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£</a> ã£ã½ã„</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Dependsã¯ <strong>é€£é–</strong> ã™ã‚‹â›“ï¸</h3>
<p><a class="reference external" href="https://fastapi.tiangolo.com/tutorial/dependencies/sub-dependencies/" rel="noreferrer" target="_blank">https://fastapi.tiangolo.com/tutorial/dependencies/sub-dependencies/</a></p>
<pre data-id="depends"><code class="python" data-noescape="" data-trim="">def query_extractor(q: str | None = None):
    # çœç•¥

def query_or_cookie_extractor(
    q: Annotated[str, Depends(query_extractor)],
    last_query: Annotated[str | None, Cookie()] = None,
):
    # çœç•¥

@app.get("/items/")
async def read_query(
    query_or_default: Annotated[str, Depends(query_or_cookie_extractor)],
):
    # çœç•¥</code></pre>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;"><code class="docutils literal notranslate"><span class="pre">Depends</span></code> ã®é€£é–ã‚’ä½¿ã£ã¦DBã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ³¨å…¥</h3>
<div class="literal-block-wrapper docutils container" id="id76">
<div class="code-block-caption"><span class="caption-text">restå±¤</span></div>
<pre><code class="python" data-noescape="" data-trim="">def inject_list_books_use_case(
    session: Annotated[type[SQLModelAsyncSession], Depends(get_session)],
) -&gt; ListBooksUseCase:</code></pre>
</div>
<div class="literal-block-wrapper docutils container" id="id77">
<div class="code-block-caption"><span class="caption-text">driverå±¤</span></div>
<pre><code class="python" data-noescape="" data-trim="">async def get_session():
    yield AsyncSession  # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§async_sessionmakerã—ã¦ã„ã‚‹</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">å‡ºå…¸ã¯ <a class="reference external" href="https://github.com/rhoboro/async-fastapi-sqlalchemy" rel="noreferrer" target="_blank">rhoboro/async-fastapi-sqlalchemy</a></h3>
<ul class="simple">
<li><p>Sub-dependenciesã«åŠ ãˆã¦ <a class="reference external" href="https://fastapi.tiangolo.com/tutorial/dependencies/classes-as-dependencies/" rel="noreferrer" target="_blank">Classes as Dependencies</a></p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id78">
<div class="code-block-caption"><span class="caption-text"><a class="reference external" href="https://github.com/rhoboro/async-fastapi-sqlalchemy/blob/12683934b451c76af5eea7ee5bf4e6c8342ca165/app/api/notes/views.py#L27-L31" rel="noreferrer" target="_blank">views.py</a> æŠœç²‹</span></div>
<pre><code class="python" data-noescape="" data-trim="">@router.get("")
async def read_all(
    use_case: ReadAllNote = Depends(ReadAllNote),
) -&gt; ReadAllNoteResponse:</code></pre>
</div>
</section>
<section>
<div class="literal-block-wrapper docutils container" id="id79">
<div class="code-block-caption"><span class="caption-text"><a class="reference external" href="https://github.com/rhoboro/async-fastapi-sqlalchemy/blob/12683934b451c76af5eea7ee5bf4e6c8342ca165/app/api/notes/use_cases.py#L22-L24" rel="noreferrer" target="_blank">use_cases.py</a> æŠœç²‹</span></div>
<pre><code class="python" data-noescape="" data-trim="">class ReadAllNote:
    def __init__(self, session: AsyncSession) -&gt; None:
        self.async_session = session</code></pre>
</div>
<div class="literal-block-wrapper docutils container" id="id80">
<div class="code-block-caption"><span class="caption-text"><a class="reference external" href="https://github.com/rhoboro/async-fastapi-sqlalchemy/blob/12683934b451c76af5eea7ee5bf4e6c8342ca165/app/db.py#L24-L31" rel="noreferrer" target="_blank">db.py</a> æŠœç²‹</span></div>
<pre><code class="python" data-noescape="" data-trim="">async def get_session() -&gt; AsyncIterator[async_sessionmaker]:
    ...

AsyncSession = Annotated[async_sessionmaker, Depends(get_session)]</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">FastAPIã® <code class="docutils literal notranslate"><span class="pre">Depends</span></code> ã¯ç©æ¥µçš„ã«æ´»ç”¨ã§ããªã„</h3>
<ul class="simple">
<li><p><strong>ãƒ¬ã‚¤ãƒ¤åˆ†ã‘</strong> ã‚’å„ªå…ˆã™ã‚‹ã¨ã€ <code class="docutils literal notranslate"><span class="pre">Depends</span></code> ã¯ domain ã‚„ usecase ã«ã¯å‹ãƒ’ãƒ³ãƒˆã§ããªã„ï¼ˆFastAPIã¯restå±¤ã®æŠ€è¡“è©³ç´°ï¼‰</p></li>
<li><p>FastAPIã¯ <code class="docutils literal notranslate"><span class="pre">Depends</span></code> ã‚’ä½¿ã„å€’ã—ãŸæ–¹ãŒé–‹ç™ºè€…ã¯æ¥½ãŒã§ããã†ï¼ˆå·®ã—æ›¿ãˆå¯èƒ½ã‚ˆã‚Šå„ªå…ˆã™ã‚‹åˆ¤æ–­ã‚‚ã‚ã‚Šå¾—ã‚‹ï¼‰</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">2ï¸âƒ£æ‹¡å¼µé–¢æ•°ã‚’å¿—å‘ã™ã‚‹</h2>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">æ‹¡å¼µé–¢æ•°ï¼ˆä¾‹ï¼šKotlinï¼‰</h3>
<ul class="simple">
<li><p>ç¶™æ‰¿ã—ãªãã¦ã‚‚ã‚¯ãƒ©ã‚¹ã«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã§ãã‚‹</p></li>
<li><p><a class="reference external" href="https://kotlinlang.org/docs/extensions.html" rel="noreferrer" target="_blank">https://kotlinlang.org/docs/extensions.html</a></p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">æ‹¡å¼µã™ã‚‹ä¾‹</h3>
<div class="literal-block-wrapper docutils container" id="id81">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">MutableList&lt;Int&gt;</span></code> ã« <code class="docutils literal notranslate"><span class="pre">swap</span></code> ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ </span></div>
<pre><code class="kotlin" data-noescape="" data-trim="">fun MutableList&lt;Int&gt;.swap(index1: Int, index2: Int) {
    val tmp = this[index1] // 'this' corresponds to the list
    this[index1] = this[index2]
    this[index2] = tmp
}</code></pre>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MutableList</span></code> ã¯collectionã®1ã¤</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãƒ¬ã‚¤ãƒ¤åˆ†ã‘ã«ãŠã‘ã‚‹æ‹¡å¼µé–¢æ•°ã®å‡ºç•ª</h3>
<ul class="simple">
<li><p>gatewayå±¤ï¼šãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ã¨ã€å¤–ç•Œã®å‹ï¼ˆè¨€èªãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‹ï¼‰ã® <strong>å¤‰æ›</strong></p></li>
<li><p>ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ã€DBã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å‹ï¼ˆåŒå¿ƒå††ã®å¤–å´ï¼‰ã‚’çŸ¥ã‚Šå¾—ãªã„</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">gatewayã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ‹¡å¼µã™ã‚‹æ¡ˆ</h3>
<pre data-id="id52"><code class="python" data-noescape="" data-trim="">def books_from_records(book_records: list[BookRecord]) -&gt; Books:
    return Books(...)

Books.from_ = staticmethod(books_from_records)  # type: ignore[attr-defined]</code></pre>
<p>gatewayã«ãŠã‘ã‚‹Booksãƒ‰ãƒ¡ã‚¤ãƒ³ã« <code class="docutils literal notranslate"><span class="pre">from_()</span></code> ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œæ™‚ã«ç”Ÿã‚„ã—ãŸ</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Pythonç‰ˆ <em>æ‹¡å¼µé–¢æ•°</em></h3>
<ul class="simple">
<li><p>ãƒ¬ã‚¤ãƒ¤é–“ã®é–¢å¿ƒã®åˆ†é›¢ã¯é”æˆï¼</p></li>
<li><p><strong>å®Ÿè³ªã¯ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</strong> ã€‚å‹ãƒã‚§ãƒƒã‚¯ã§æ€’ã‚‰ã‚Œã€ã‚³ãƒ¼ãƒ‰ã‚¸ãƒ£ãƒ³ãƒ—ã«å½±éŸ¿</p></li>
</ul>
<p>ä»–ã®æ–¹æ³•ã¯ä»Šã¯æµ®ã‹ã‚“ã§ã„ã¾ã›ã‚“...</p>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">ãŠå“æ›¸ãï¼šFastAPIã®ç¾å ´ã‹ã‚‰</h2>
<ol class="arabic simple">
<li><p>éåŒæœŸIO</p></li>
<li><p>ã‚¯ãƒªãƒ¼ãƒ³ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å¿—å‘ã™ã‚‹</p></li>
<li><p><strong>Twelve-Factor App</strong></p></li>
</ol>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;"><a class="reference external" href="https://12factor.net/ja/" rel="noreferrer" target="_blank">Twelve-Factor App</a></h3>
<blockquote>
<div><p>ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å¤šç¨®å¤šæ§˜ãªSaaSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºç¾å ´ã§ã®ç§ãŸã¡ã®çµŒé¨“ã¨è¦³å¯Ÿã‚’ã™ã¹ã¦ã¾ã¨ã‚ãŸã‚‚ã®ã§ã‚ã‚‹ã€‚</p>
</div></blockquote>
<p>ç’°å¢ƒå¤‰æ•°ã¨ãƒ­ã‚®ãƒ³ã‚°ã®2ã¤ã«ã¤ã„ã¦å–ã‚Šä¸Šã’ã¾ã™</p>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">1ï¸âƒ£ III. è¨­å®š</h2>
<blockquote>
<div><p>è¨­å®šã‚’ç’°å¢ƒå¤‰æ•°ã«æ ¼ç´ã™ã‚‹</p>
</div></blockquote>
<p><a class="reference external" href="https://12factor.net/ja/config" rel="noreferrer" target="_blank">https://12factor.net/ja/config</a></p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">è¨­å®šã‚’ <strong>ç’°å¢ƒå¤‰æ•°</strong> ã«</h3>
<ul class="simple">
<li><p>è¨­å®šã¨ã¯ä¾‹ãˆã°ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š</p></li>
<li><p>è¨­å®šã‚’ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å³å¯†ã«åˆ†é›¢ã—ãŸã„</p></li>
<li><p>ç’°å¢ƒå¤‰æ•°ã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã€ <strong>ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ã—ãªã„</strong> ãŒå®Ÿç¾ã§ãã‚‹</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">pydantic-settings</h3>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.pydantic.dev/latest/concepts/pydantic_settings/" rel="noreferrer" target="_blank">https://docs.pydantic.dev/latest/concepts/pydantic_settings/</a></p></li>
<li><p>ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€ + Pydanticã«ã‚ˆã‚‹ãƒ‘ãƒ¼ã‚¹</p></li>
<li><p>ç’°å¢ƒå¤‰æ•°ã ã‘ã§ãªã <code class="file docutils literal notranslate"><span class="pre">.env</span></code> ã‚‚ã‚µãƒãƒ¼ãƒˆ</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">pydantic-settingsã§ã®è¨­å®šä¾‹</h3>
<pre data-id="id56"><code class="python" data-noescape="" data-trim="">from pydantic import PostgresDsn
from pydantic_settings import BaseSettings


class Config(BaseSettings):
    pg_dsn: PostgresDsn


config = Config()</code></pre>
<p>ç’°å¢ƒå¤‰æ•° <code class="docutils literal notranslate"><span class="pre">PG_DSN</span></code> ã§è¨­å®šã§ãã‚‹</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãƒã‚¹ãƒˆã‚‚å¯èƒ½</h3>
<p>DBã®è¨­å®šã€LLM APIã®è¨­å®šã¨åˆ†ã‘ãŸã„</p>
<pre data-id="id57"><code class="python" data-noescape="" data-trim="">class DB(BaseModel):
    pg_dsn: PostgresDsn

class LlmApi(BaseModel):
    api_key: str

class Config(BaseSettings):
    model_config = SettingsConfigDict(env_nested_delimiter="__")
    db: DB
    llm: LlmApi

config = Config()</code></pre>
<p>ç’°å¢ƒå¤‰æ•° <code class="docutils literal notranslate"><span class="pre">DB__PG_DSN</span></code> ã‚„ <code class="docutils literal notranslate"><span class="pre">LLM__API_KEY</span></code></p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">è¨­å®šã®ä½¿ã„æ–¹</h3>
<div class="literal-block-wrapper docutils container" id="id82">
<div class="code-block-caption"><span class="caption-text">driverå±¤</span></div>
<pre><code class="python" data-line-numbers="1,3" data-noescape="" data-trim="">from books_api.config import config

async_engine = create_async_engine(str(config.pg_dsn))
AsyncSession = async_sessionmaker(async_engine, class_=SQLModelAsyncSession)</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ğŸƒâ€â™‚ï¸è„±ç·šï¼špydantic-settingsã§CLIã‚‚ä½œã‚Œã¾ã™ï¼</h3>
<ul class="simple">
<li><p>å€‹äººçš„ã‚¤ãƒã‚ªã‚·ãƒã‚¤ãƒ³ãƒˆï¼ˆã•ã‚ˆãªã‚‰argparseï¼‰</p></li>
<li><p>æ‹™ãƒ–ãƒ­ã‚° <a class="reference external" href="https://nikkie-ftnext.hatenablog.com/entry/pydantic-settings-cli-application-args-optional-environment-positional" rel="noreferrer" target="_blank">pydantic-settingsã§ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã‚‚æŒ‡å®šã§ãã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°ã‚’æŒã¤CLIã‚’ä½œã‚‹</a></p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">2ï¸âƒ£ XI. ãƒ­ã‚°</h2>
<blockquote>
<div><p>ãƒ­ã‚°ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã—ã¦æ‰±ã†</p>
</div></blockquote>
<p><a class="reference external" href="https://12factor.net/ja/logs" rel="noreferrer" target="_blank">https://12factor.net/ja/logs</a></p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªã <strong>ã‚¹ãƒˆãƒªãƒ¼ãƒ </strong></h3>
<blockquote>
<div><p>ãã‚Œãã‚Œã®å®Ÿè¡Œä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’stdoutï¼ˆæ¨™æº–å‡ºåŠ›ï¼‰ã«ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã›ãšã«æ›¸ãã ã™ã€‚</p>
</div></blockquote>
<p>k8s(GKE)ã®Podã‚„ã€Google Cloudã®Cloud Loggingã§è¦‹ã¦ã„ã¾ã™</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">uvicornã«ã‚ˆã‚‹ãƒ­ã‚®ãƒ³ã‚°</h3>
<ul class="simple">
<li><p><strong class="command">uvicorn app:app</strong></p></li>
<li><p><a class="reference external" href="https://www.uvicorn.org/settings/#logging" rel="noreferrer" target="_blank">https://www.uvicorn.org/settings/#logging</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--log-level</span></code> ã‚„ <strong>--log-config</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fastapi</span></code> ã‚³ãƒãƒ³ãƒ‰ã‚ˆã‚Šé«˜æ©Ÿèƒ½ãªã®ã§ã“ã¡ã‚‰ã‚’é¸æŠ</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">Pythonã®ãƒ­ã‚®ãƒ³ã‚°ã®è¦ç´ ï¼ˆæŠœç²‹ï¼‰</h3>
<ul class="simple">
<li><p>ãƒ­ã‚¬ãƒ¼</p></li>
<li><p>ãƒãƒ³ãƒ‰ãƒ©</p></li>
<li><p>ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿</p></li>
</ul>
<p>2é€±å‰ã®PyCon mini Shizuoka 2024 continueã§ <a class="reference external" href="https://ftnext.github.io/2025-slides/pyconshizu/logging-with-nullhandler.html#/1" rel="noreferrer" target="_blank">ãƒ­ã‚®ãƒ³ã‚°ã®è©±</a> ã‚’ã—ã¾ã—ãŸ</p>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®log config</h3>
<ul>
<li><p>uvicornãƒ­ã‚¬ãƒ¼ï¼ˆæ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ï¼‰</p>
<blockquote>
<div><ul class="simple">
<li><p>uvicorn.errorãƒ­ã‚¬ãƒ¼ã‹ã‚‰propagate</p></li>
</ul>
</div></blockquote>
</li>
<li><p>uvicorn.accessãƒ­ã‚¬ãƒ¼ï¼ˆæ¨™æº–å‡ºåŠ›ï¼‰</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">è‰²ãŒä»˜ãã®ã¯uvicornè‡ªå‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã«ã‚ˆã‚‹</h3>
<ul>
<li><p>uvicorn.logging.DefaultFormatter</p>
<blockquote>
<div><ul class="simple">
<li><p>ãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ã® <code class="docutils literal notranslate"><span class="pre">levelprefix</span></code> ã«è‰²ã‚’ä»˜ã‘ã‚‹</p></li>
</ul>
</div></blockquote>
</li>
<li><p>uvicorn.logging.AccessFormatter</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">è¨­å®šã®ä»•æ–¹ã¯æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª logging.config ã‚ˆã‚Š</h3>
<div class="literal-block-wrapper docutils container" id="id83">
<div class="code-block-caption"><span class="caption-text">uvicornãƒ­ã‚¬ãƒ¼ã®è¨­å®šï¼ˆæŠœç²‹ï¼‰</span></div>
<pre><code class="yaml" data-noescape="" data-trim="">version: 1
formatters:
  default:
    class: uvicorn.logging.DefaultFormatter
    format: '%(levelprefix)s %(message)s'
    use_colors: null
handlers:
  default:
    formatter: default
    class: logging.StreamHandler
    stream: ext://sys.stderr
loggers:
  uvicorn:
    handlers:
      - default
    level: INFO
    propagate: false
  uvicorn.error:
    level: INFO
disable_existing_loggers: false</code></pre>
</div>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">è¨­å®šä¾‹ï¼šç™ºè¡Œã•ã‚Œã‚‹SQLã‚’ãƒ­ã‚°å‡ºåŠ›</h3>
<div class="literal-block-wrapper docutils container" id="id84">
<div class="code-block-caption"><span class="caption-text">sqlalchemy.engineãƒ­ã‚¬ãƒ¼ã‚’è¨­å®š</span></div>
<pre><code class="yaml" data-noescape="" data-trim="">formatters:
  default:
    class: uvicorn.logging.DefaultFormatter
    format: '%(asctime)s - %(name)s - %(levelprefix)s - %(message)s'
    use_colors: null
handlers:
  default_stdout:
    formatter: default
    class: logging.StreamHandler
    stream: ext://sys.stdout
loggers:
  sqlalchemy.engine:
    handlers:
      - default_stdout
    level: INFO</code></pre>
</div>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">å°ã¾ã¨ã‚ğŸ¥Ÿ Twelve-Factor App</h2>
<ul class="simple">
<li><p><strong>pydantic-settings</strong> ã«ã‚ˆã‚‹ã€ç’°å¢ƒå¤‰æ•°ã§ã®è¨­å®š</p></li>
<li><p>ãƒ­ã‚®ãƒ³ã‚°ã¯ <strong>logging.config ã«æ²¿ã£ã¦ uvicorn</strong> ã‚’è¨­å®š</p></li>
</ul>
</section>
</section>
<section>
<section>
<h2 style="word-break: keep-all; overflow-wrap: break-word;">ã¾ã¨ã‚ğŸŒ¯ FastAPIã®ç¾å ´ã‹ã‚‰</h2>
<ul class="simple">
<li><p>SQLModelï¼ˆSQLAlchemyï¼‰ã§ <strong>å…¨éƒ¨ async def ã§æ›¸ã‘ã‚‹</strong> FastAPIã‚¢ãƒ—ãƒªï¼</p></li>
<li><p><strong>ãƒ¬ã‚¤ãƒ¤åˆ†ã‘</strong> ã—ã¦ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„DBã‚’åˆ‡ã‚Šé›¢ã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</p></li>
<li><p>ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è¨­å®šã§ãã‚‹ pydantic-settingsã€‚uvicornã§ã®ãƒ­ã‚®ãƒ³ã‚°</p></li>
</ul>
</section>
<section>
<h3 style="word-break: keep-all; overflow-wrap: break-word;">ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ</h3>
</section>
</section>

        </div>
    </div>
    
    <script src="../_static/revealjs/dist/reveal.js"></script>
    
    
      <script src="../_static/revealjs/plugin/highlight/highlight.js"></script>
      <script src="../_static/revealjs/plugin/notes/notes.js"></script>
      <script src="../_static/revealjs/plugin/copycode/copycode.js"></script>
      
    
    <script>
        var revealjsConfig = new Object();
        Object.assign(revealjsConfig, {"controls": true, "progress": true, "history": true, "center": true, "transition": "none", "slideNumber": "c/t", "scrollActivationWidth": null});
        
        
        
          revealjsConfig.plugins = [
            RevealHighlight,RevealNotes,CopyCode,
          ];
        
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize(revealjsConfig);
    </script>

  </body>
</html>